# 列表页开发规范文档

本文档定义了后台管理系统列表页的统一开发规范，确保所有列表页在布局、交互和代码结构上保持一致。

## 目录

- [文件结构](#文件结构)
- [页面布局](#页面布局)
- [表格组件](#表格组件)
- [列定义](#列定义)
- [状态标签样式](#状态标签样式)
- [操作列菜单](#操作列菜单)
- [翻页组件](#翻页组件)
- [工具栏配置](#工具栏配置)
- [弹窗组件](#弹窗组件)
- [完整示例](#完整示例)

---

## 文件结构

每个列表页模块应采用以下文件结构：

```
src/features/{module-name}/
├── index.tsx                      # 主页面（数据获取、弹窗状态、布局）
└── components/
    ├── {module}-columns.tsx       # 列定义
    ├── {module}-table.tsx         # 表格组件
    └── {module}-dialogs.tsx       # 弹窗组件（可选，复杂时拆分）
```

**命名规范：**
- 文件名使用 `kebab-case`（如 `campaigns-columns.tsx`）
- 组件名使用 `PascalCase`（如 `CampaignsTable`）
- 列定义函数使用 `get{Module}Columns` 格式

---

## 页面布局

### 基本结构

```tsx
import { Header } from '@/components/layout/header'
import { Main } from '@/components/layout/main'
import { TopNav } from '@/components/layout/top-nav'

export function ModulePage() {
  return (
    <>
      <Header fixed>
        <TopNav links={topNav} />
        <div className='ms-auto flex items-center space-x-4'>
          <Search />
          <MessageButton />
          <ThemeSwitch />
          <ConfigDrawer />
          <ProfileDropdown />
        </div>
      </Header>

      <Main className='flex flex-1 flex-col gap-4 sm:gap-6'>
        {/* 标题区 */}
        <div className='flex flex-wrap items-end justify-between gap-2'>
          <div>
            <h2 className='text-2xl font-bold tracking-tight'>页面标题</h2>
            <p className='text-muted-foreground'>页面描述文字</p>
          </div>
          <Button onClick={handleCreate}>
            <Plus className='mr-2 h-4 w-4' />
            新建按钮
          </Button>
        </div>

        {/* 表格组件 */}
        <ModuleTable ... />
      </Main>

      {/* 弹窗 */}
      <Dialog ... />
    </>
  )
}
```

### 布局要点

1. **不使用 Card 包裹**：表格直接放在 `Main` 组件内
2. **标题区与操作按钮**：使用 `flex justify-between` 布局
3. **间距**：使用 `gap-4 sm:gap-6` 统一间距

---

## 表格组件

### 核心依赖

```tsx
import {
  type ColumnFiltersState,
  type PaginationState,
  type SortingState,
  type VisibilityState,
  flexRender,
  getCoreRowModel,
  getFacetedRowModel,
  getFacetedUniqueValues,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from '@tanstack/react-table'
```

### 表格配置（服务端分页）

```tsx
const table = useReactTable({
  data,
  columns,
  pageCount: Math.ceil(total / pageSize),
  state: {
    sorting,
    pagination,
    rowSelection,
    columnFilters,
    columnVisibility,
  },
  manualPagination: true,  // 关键：服务端分页
  enableRowSelection: true,
  onRowSelectionChange: setRowSelection,
  onSortingChange: setSorting,
  onColumnFiltersChange: setColumnFilters,
  onColumnVisibilityChange: setColumnVisibility,
  onPaginationChange: (updater) => {
    const newPagination = typeof updater === 'function' ? updater(pagination) : updater
    if (newPagination.pageIndex !== pagination.pageIndex) {
      onPageChange(newPagination.pageIndex + 1)
    }
    if (newPagination.pageSize !== pagination.pageSize) {
      onPageSizeChange(newPagination.pageSize)
    }
  },
  getCoreRowModel: getCoreRowModel(),
  getFilteredRowModel: getFilteredRowModel(),
  getPaginationRowModel: getPaginationRowModel(),
  getSortedRowModel: getSortedRowModel(),
  getFacetedRowModel: getFacetedRowModel(),
  getFacetedUniqueValues: getFacetedUniqueValues(),
})
```

### 表格渲染模板

```tsx
<div className='overflow-hidden rounded-md border'>
  <Table>
    <TableHeader>
      {table.getHeaderGroups().map((headerGroup) => (
        <TableRow key={headerGroup.id} className='group/row'>
          {headerGroup.headers.map((header) => (
            <TableHead
              key={header.id}
              colSpan={header.colSpan}
              className={cn(
                'bg-background group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted',
                header.column.columnDef.meta?.className
              )}
            >
              {header.isPlaceholder
                ? null
                : flexRender(
                  header.column.columnDef.header,
                  header.getContext()
                )}
            </TableHead>
          ))}
        </TableRow>
      ))}
    </TableHeader>
    <TableBody>
      {isLoading ? (
        <TableRow>
          <TableCell colSpan={columns.length} className='h-24 text-center'>
            加载中...
          </TableCell>
        </TableRow>
      ) : table.getRowModel().rows?.length ? (
        table.getRowModel().rows.map((row) => (
          <TableRow
            key={row.id}
            data-state={row.getIsSelected() && 'selected'}
            className='group/row'
          >
            {row.getVisibleCells().map((cell) => (
              <TableCell
                key={cell.id}
                className={cn(
                  'bg-background group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted',
                  cell.column.columnDef.meta?.className
                )}
              >
                {flexRender(cell.column.columnDef.cell, cell.getContext())}
              </TableCell>
            ))}
          </TableRow>
        ))
      ) : (
        <TableRow>
          <TableCell colSpan={columns.length} className='h-24 text-center'>
            暂无数据
          </TableCell>
        </TableRow>
      )}
    </TableBody>
  </Table>
</div>
```

---

## 列定义

### 基本结构

```tsx
import { type ColumnDef } from '@tanstack/react-table'
import { DataTableColumnHeader } from '@/components/data-table'

interface ColumnsProps {
  onEdit: (item: ItemType) => void
  onDelete: (id: string) => void
}

export function getColumns({ onEdit, onDelete }: ColumnsProps): ColumnDef<ItemType>[] {
  return [
    // 列定义...
  ]
}
```

### 常用列类型

**文本列（可排序）：**
```tsx
{
  accessorKey: 'name',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='名称' />
  ),
  cell: ({ row }) => (
    <div className='font-medium'>{row.getValue('name')}</div>
  ),
  enableHiding: false,  // 禁止隐藏主要列
}
```

**Badge 列：**
```tsx
{
  accessorKey: 'type',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='类型' />
  ),
  cell: ({ row }) => (
    <Badge variant='outline'>
      {typeMap[row.getValue('type') as string]}
    </Badge>
  ),
  filterFn: (row, id, value) => value.includes(row.getValue(id)),
}
```

**计算列（无 accessorKey）：**
```tsx
{
  id: 'fullName',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='姓名' />
  ),
  cell: ({ row }) => {
    const { firstName, lastName } = row.original
    return <span>{`${firstName} ${lastName}`}</span>
  },
  enableSorting: false,
}
```

---

## 状态标签样式

### 颜色映射定义

```tsx
// 通用状态颜色
const statusColors = new Map<string, string>([
  ['active', 'bg-teal-100/30 text-teal-900 dark:text-teal-200 border-teal-200'],
  ['inactive', 'bg-neutral-300/40 border-neutral-300'],
  ['pending', 'bg-sky-200/40 text-sky-900 dark:text-sky-100 border-sky-300'],
  ['suspended', 'bg-destructive/10 dark:bg-destructive/50 text-destructive dark:text-primary border-destructive/10'],
])
```

### 状态颜色语义

| 语义 | 颜色 | 适用状态 |
|------|------|---------|
| 成功/启用/进行中 | `teal` (青绿) | active, enabled, running, rewarded |
| 禁用/结束/默认 | `neutral` (灰色) | inactive, disabled, ended, closed |
| 等待/待处理 | `sky` (天蓝) | pending, waiting, invited |
| 警告/暂停 | `amber` (琥珀) | warning, paused, registered |
| 错误/取消/无效 | `destructive` (红色) | error, cancelled, invalid, suspended |

### 使用方式

```tsx
{
  accessorKey: 'status',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='状态' />
  ),
  cell: ({ row }) => {
    const status = row.getValue('status') as string
    const badgeColor = statusColors.get(status)
    return (
      <Badge variant='outline' className={cn(badgeColor)}>
        {statusLabels[status] || status}
      </Badge>
    )
  },
  filterFn: (row, id, value) => value.includes(row.getValue(id)),
  enableHiding: false,
  enableSorting: false,
}
```

---

## 操作列菜单

### 标准实现

```tsx
import { DotsHorizontalIcon } from '@radix-ui/react-icons'
import { Pencil, Trash2 } from 'lucide-react'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'

{
  id: 'actions',
  cell: ({ row }) => {
    const item = row.original
    return (
      <DropdownMenu modal={false}>
        <DropdownMenuTrigger asChild>
          <Button
            variant='ghost'
            className='data-[state=open]:bg-muted flex h-8 w-8 p-0'
          >
            <DotsHorizontalIcon className='h-4 w-4' />
            <span className='sr-only'>打开菜单</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align='end' className='w-[160px]'>
          <DropdownMenuItem onClick={() => onEdit(item)}>
            编辑
            <DropdownMenuShortcut>
              <Pencil size={16} />
            </DropdownMenuShortcut>
          </DropdownMenuItem>
          <DropdownMenuSeparator />
          <DropdownMenuItem
            onClick={() => onDelete(item.id)}
            className='text-red-500!'
          >
            删除
            <DropdownMenuShortcut>
              <Trash2 size={16} />
            </DropdownMenuShortcut>
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    )
  },
}
```

### 菜单项规范

- 使用 `modal={false}` 避免弹窗层级问题
- 删除操作使用 `text-red-500!` 样式
- 删除操作前添加 `DropdownMenuSeparator`
- 每个菜单项配合图标使用 `DropdownMenuShortcut`

---

## 翻页组件

### 使用 DataTablePagination

```tsx
import { DataTablePagination } from '@/components/data-table'

// 在表格组件底部
<DataTablePagination table={table} className='mt-auto' />
```

### 功能特性

- 显示当前选中行数
- 显示总行数
- 每页条数选择（10/20/30/40/50）
- 首页/上一页/下一页/末页按钮
- 当前页码/总页数显示

---

## 工具栏配置

### 使用 DataTableToolbar

```tsx
import { DataTableToolbar } from '@/components/data-table'

<DataTableToolbar
  table={table}
  searchPlaceholder='搜索...'
  searchKey='name'  // 指定搜索字段，不指定则全局搜索
  filters={[
    {
      columnId: 'status',
      title: '状态',
      options: [
        { label: '启用', value: 'active' },
        { label: '禁用', value: 'inactive' },
      ],
    },
    {
      columnId: 'type',
      title: '类型',
      options: [
        { label: '类型A', value: 'a' },
        { label: '类型B', value: 'b' },
      ],
    },
  ]}
/>
```

### 工具栏功能

- 搜索框（支持指定字段或全局搜索）
- 多选筛选器（FacetedFilter）
- 列显隐控制（ViewOptions）
- 重置按钮（自动出现）

---

## 弹窗组件

### Dialog 结构

```tsx
<Dialog open={dialogOpen} onOpenChange={setDialogOpen}>
  <DialogContent className='max-w-2xl'>
    <DialogHeader>
      <DialogTitle>{editing ? '编辑' : '新建'}项目</DialogTitle>
      <DialogDescription>描述文字</DialogDescription>
    </DialogHeader>

    <form onSubmit={handleSubmit}>
      <div className='grid gap-4 py-4'>
        {/* 表单字段 */}
      </div>

      <DialogFooter>
        <Button type='button' variant='outline' onClick={() => setDialogOpen(false)}>
          取消
        </Button>
        <Button type='submit' disabled={isPending}>
          {editing ? '更新' : '创建'}
        </Button>
      </DialogFooter>
    </form>
  </DialogContent>
</Dialog>
```

### 表单布局

```tsx
{/* 双列布局 */}
<div className='grid grid-cols-2 gap-4'>
  <div>
    <Label htmlFor='field1'>字段1 *</Label>
    <Input id='field1' name='field1' required />
  </div>
  <div>
    <Label htmlFor='field2'>字段2</Label>
    <Input id='field2' name='field2' />
  </div>
</div>

{/* 三列布局 */}
<div className='grid grid-cols-3 gap-4'>
  ...
</div>

{/* 复选框行 */}
<div className='flex items-center justify-between'>
  <Label htmlFor='enabled'>启用</Label>
  <input
    id='enabled'
    name='enabled'
    type='checkbox'
    defaultChecked={editing?.enabled ?? true}
    className='h-4 w-4'
  />
</div>
```

---

## 完整示例

参考以下文件作为完整实现示例：

- **员工列表**（标准参照）
  - `src/features/hr/index.tsx`
  - `src/features/hr/components/employees-table.tsx`
  - `src/features/hr/components/employees-columns.tsx`

- **活动管理**（营销中心示例）
  - `src/features/marketing/campaigns/index.tsx`
  - `src/features/marketing/campaigns/components/campaigns-table.tsx`
  - `src/features/marketing/campaigns/components/campaigns-columns.tsx`

---

## 检查清单

开发新列表页时，请确认以下要点：

- [ ] 文件结构符合规范（index.tsx + components/）
- [ ] 使用 `Header` + `Main` 布局，不使用 Card 包裹
- [ ] 表格使用 `@tanstack/react-table`
- [ ] 翻页使用 `DataTablePagination`
- [ ] 工具栏使用 `DataTableToolbar`
- [ ] 状态列使用 `Badge variant='outline'` + 颜色映射
- [ ] 操作列使用 `DropdownMenu` 下拉菜单
- [ ] 表格容器使用 `overflow-hidden rounded-md border`
- [ ] 服务端分页配置 `manualPagination: true`
- [ ] 弹窗使用标准 Dialog 结构
