# 模块页面接入清单与排期

> **文档版本**: v1.2  
> **创建日期**: 2024-12-12  
> **状态**: 📋 规划中  
> **返回**: [总览](./README.md)

---

## 一、营销中心页面接入

### 1.1 终端页面清单

| 页面路径 | 路由 Key | 功能说明 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| `/pages/marketing/membership/index` | `membership` | 会员中心首页 | **P0** | ❌ 待开发 |
| `/pages/marketing/membership/plans` | `membership-plans` | 会员套餐列表 | **P0** | ❌ 待开发 |
| `/pages/marketing/coupons/index` | `coupons` | 我的优惠券列表 | **P0** | ❌ 待开发 |
| `/pages/marketing/coupons/available` | `coupons-available` | 可领取优惠券 | P1 | ❌ 待开发 |
| `/pages/marketing/points/index` | `points` | 积分首页 | P1 | ❌ 待开发 |
| `/pages/marketing/points/records` | `points-records` | 积分明细 | P1 | ❌ 待开发 |
| `/pages/marketing/referrals/index` | `referrals` | 邀请好友 | P1 | ❌ 待开发 |
| `/pages/marketing/campaigns/index` | `campaigns` | 活动列表 | P1 | ❌ 待开发 |
| `/pages/marketing/campaigns/detail` | `campaigns-detail` | 活动详情 | P1 | ❌ 待开发 |

### 1.2 预览器页面组件清单

| 组件文件 | 路径 | 优先级 | 状态 |
|---------|------|--------|------|
| `MembershipPage.tsx` | `components/pages/marketing/` | P0 | ❌ 待开发 |
| `MembershipPlansPage.tsx` | `components/pages/marketing/` | P0 | ❌ 待开发 |
| `CouponsPage.tsx` | `components/pages/marketing/` | P0 | ❌ 待开发 |
| `CouponsAvailablePage.tsx` | `components/pages/marketing/` | P1 | ❌ 待开发 |
| `PointsPage.tsx` | `components/pages/marketing/` | P1 | ❌ 待开发 |
| `PointsRecordsPage.tsx` | `components/pages/marketing/` | P1 | ❌ 待开发 |
| `ReferralsPage.tsx` | `components/pages/marketing/` | P1 | ❌ 待开发 |
| `CampaignsPage.tsx` | `components/pages/marketing/` | P1 | ❌ 待开发 |
| `CampaignDetailPage.tsx` | `components/pages/marketing/` | P1 | ❌ 待开发 |

### 1.3 API 接入清单

| API 方法 | 路径 | 请求通道 | 优先级 | 状态 |
|---------|------|---------|--------|------|
| `getMembershipLevels()` | `/marketing/membership/levels` | userRequest | P0 | ❌ 待接入 |
| `getMyMembership()` | `/marketing/membership/my` | userRequest | P0 | ❌ 待接入 |
| `getMembershipPlans()` | `/marketing/membership/plans` | userRequest | P0 | ❌ 待接入 |
| `getMyCoupons()` | `/marketing/coupons/my` | userRequest | P0 | ❌ 待接入 |
| `getAvailableCoupons()` | `/marketing/coupons/available` | userRequest | P1 | ❌ 待接入 |
| `getMyPoints()` | `/marketing/points/my` | userRequest | P1 | ❌ 待接入 |
| `getPointsRecords()` | `/marketing/points/records` | userRequest | P1 | ❌ 待接入 |
| `getReferralInfo()` | `/marketing/referrals/info` | userRequest | P1 | ❌ 待接入 |
| `getCampaigns()` | `/marketing/campaigns` | userRequest | P1 | ❌ 待接入 |
| `getCampaignDetail()` | `/marketing/campaigns/:id` | userRequest | P1 | ❌ 待接入 |

### 1.4 管理后台集成点

| 管理页面 | 路由 | 预览页面 | 优先级 | 状态 |
|---------|------|---------|--------|------|
| 会员管理 | `/marketing/membership` | `membership`, `membership-plans` | P0 | ❌ 待集成 |
| 优惠券管理 | `/marketing/coupons` | `coupons`, `coupons-available` | P0 | ❌ 待集成 |
| 积分管理 | `/marketing/points` | `points`, `points-records` | P1 | ❌ 待集成 |
| 邀请奖励 | `/marketing/referrals` | `referrals` | P1 | ❌ 待集成 |
| 活动管理 | `/marketing/campaigns` | `campaigns`, `campaigns-detail` | P1 | ❌ 待集成 |

### 1.5 终端源码参考

| 页面 | 终端源码位置 |
|------|-------------|
| 会员中心 | `miniapp/src/pages/marketing/membership/index.tsx` |
| 会员套餐 | `miniapp/src/pages/marketing/membership/plans.tsx` |
| 优惠券 | `miniapp/src/pages/marketing/coupons/index.tsx` |
| 可领优惠券 | `miniapp/src/pages/marketing/coupons/available.tsx` |
| 积分 | `miniapp/src/pages/marketing/points/index.tsx` |
| 积分明细 | `miniapp/src/pages/marketing/points/records.tsx` |
| 邀请 | `miniapp/src/pages/marketing/referrals/index.tsx` |
| 活动列表 | `miniapp/src/pages/marketing/campaigns/index.tsx` |
| 活动详情 | `miniapp/src/pages/marketing/campaigns/detail.tsx` |

---

## 二、陪诊员系统页面接入

### 2.1 终端页面清单

| 页面路径 | 路由 Key | 功能说明 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| `/pages/escort/list` | `escort-list` | 陪诊员列表 | **P1** | ❌ 待开发 |
| `/pages/escort/detail` | `escort-detail` | 陪诊员详情 | **P1** | ❌ 待开发 |
| `/pages/workbench/index` | `workbench` | 工作台首页 | P2 | ❌ 待开发 |
| `/pages/workbench/orders/pool` | `workbench-orders-pool` | 订单池 | P2 | ❌ 待开发 |
| `/pages/workbench/orders/detail` | `workbench-order-detail` | 订单详情 | P2 | ❌ 待开发 |
| `/pages/workbench/earnings/index` | `workbench-earnings` | 收入统计 | P2 | ❌ 待开发 |
| `/pages/workbench/withdraw/index` | `workbench-withdraw` | 提现页面 | P2 | ❌ 待开发 |
| `/pages/workbench/settings/index` | `workbench-settings` | 工作台设置 | P2 | ❌ 待开发 |

### 2.2 预览器页面组件清单

| 组件文件 | 路径 | 优先级 | 状态 |
|---------|------|--------|------|
| `EscortListPage.tsx` | `components/pages/escort/` | P1 | ❌ 待开发 |
| `EscortDetailPage.tsx` | `components/pages/escort/` | P1 | ❌ 待开发 |
| `WorkbenchPage.tsx` | `components/pages/workbench/` | P2 | ❌ 待开发 |
| `WorkbenchOrdersPoolPage.tsx` | `components/pages/workbench/` | P2 | ❌ 待开发 |
| `WorkbenchOrderDetailPage.tsx` | `components/pages/workbench/` | P2 | ❌ 待开发 |
| `WorkbenchEarningsPage.tsx` | `components/pages/workbench/` | P2 | ❌ 待开发 |
| `WorkbenchWithdrawPage.tsx` | `components/pages/workbench/` | P2 | ❌ 待开发 |

### 2.3 API 接入清单

| API 方法 | 路径 | 请求通道 | 优先级 | 状态 |
|---------|------|---------|--------|------|
| `getEscorts()` | `/escorts` | userRequest | P1 | ❌ 待接入 |
| `getEscortDetail()` | `/escorts/:id` | userRequest | P1 | ❌ 待接入 |
| `getWorkbenchStats()` | `/escort-app/workbench/stats` | **escortRequest** | P2 | ❌ 待接入 |
| `getOrderPool()` | `/escort-app/orders/pool` | **escortRequest** | P2 | ❌ 待接入 |
| `getWorkbenchOrderDetail()` | `/escort-app/orders/:id` | **escortRequest** | P2 | ❌ 待接入 |
| `getEarningsStats()` | `/escort-app/earnings/stats` | **escortRequest** | P2 | ❌ 待接入 |
| `getWithdrawInfo()` | `/escort-app/withdraw/info` | **escortRequest** | P2 | ❌ 待接入 |

### 2.4 管理后台集成点

| 管理页面 | 路由 | 预览页面 | 优先级 | 状态 |
|---------|------|---------|--------|------|
| 陪诊员管理 | `/escorts` | `escort-list`, `escort-detail` | P1 | ❌ 待集成 |
| 工作台管理 | `/escort-app/workbench` | `workbench` | P2 | ❌ 待集成 |

### 2.5 终端源码参考

| 页面 | 终端源码位置 |
|------|-------------|
| 陪诊员列表 | `miniapp/src/pages/escort/list.tsx` |
| 陪诊员详情 | `miniapp/src/pages/escort/detail.tsx` |
| 工作台 | `miniapp/src/pages/workbench/index.tsx` |
| 订单池 | `miniapp/src/pages/workbench/orders/pool.tsx` |
| 订单详情 | `miniapp/src/pages/workbench/orders/detail.tsx` |
| 收入统计 | `miniapp/src/pages/workbench/earnings/index.tsx` |
| 提现 | `miniapp/src/pages/workbench/withdraw/index.tsx` |

---

## 三、分销系统分析

### 3.1 终端页面分析

**结论：分销系统在终端（小程序）中无独立页面。**

分销功能主要通过以下方式体现：
1. **邀请好友页面**（`/pages/marketing/referrals/index`）- 已归类到营销中心
2. **个人中心入口** - 分销关系查看（如存在）
3. **后台管理** - 分销配置、分润记录查看

### 3.2 建议

- **优先级：P2（低）**
- 先完成营销中心和陪诊员系统集成
- 根据实际需求决定是否集成分销预览

---

## 四、实施排期

### 4.1 阶段一：营销中心基础集成（P0，第 1-2 周）

**目标：** 完成营销中心核心页面的预览器集成

**任务清单：**

| 任务 | 负责人 | 预估工时 | 状态 |
|------|--------|---------|------|
| 扩展 `TerminalPreviewProps.page` 类型 | - | 2h | ❌ |
| 创建 `MembershipPage.tsx` | - | 4h | ❌ |
| 创建 `MembershipPlansPage.tsx` | - | 3h | ❌ |
| 创建 `CouponsPage.tsx` | - | 4h | ❌ |
| 在 `previewApi` 中添加会员/优惠券 API | - | 2h | ❌ |
| 更新路由分发逻辑 | - | 1h | ❌ |
| 在会员管理页面集成预览器 | - | 3h | ❌ |
| 在优惠券管理页面集成预览器 | - | 3h | ❌ |
| 测试数据覆盖机制 | - | 2h | ❌ |

**第二周追加：**

| 任务 | 负责人 | 预估工时 | 状态 |
|------|--------|---------|------|
| 创建 `CouponsAvailablePage.tsx` | - | 3h | ❌ |
| 创建 `PointsPage.tsx` | - | 3h | ❌ |
| 创建 `PointsRecordsPage.tsx` | - | 2h | ❌ |
| 创建 `ReferralsPage.tsx` | - | 4h | ❌ |
| 创建 `CampaignsPage.tsx` | - | 3h | ❌ |
| 创建 `CampaignDetailPage.tsx` | - | 3h | ❌ |
| 在 `previewApi` 中添加积分/邀请/活动 API | - | 2h | ❌ |
| 集成到对应管理页面 | - | 4h | ❌ |

**交付物：**
- ✅ 营销中心所有页面可在预览器中查看
- ✅ 管理后台相关页面集成预览器

### 4.2 阶段二：陪诊员系统集成（P1，第 3-4 周）

**目标：** 完成陪诊员相关页面的预览器集成

**任务清单：**

| 任务 | 负责人 | 预估工时 | 状态 |
|------|--------|---------|------|
| 实现身份上下文机制 | - | 4h | ❌ |
| 创建 `EscortListPage.tsx` | - | 4h | ❌ |
| 创建 `EscortDetailPage.tsx` | - | 4h | ❌ |
| 在 `previewApi` 中添加陪诊员公开 API | - | 2h | ❌ |
| 实现角色切换功能 | - | 3h | ❌ |
| 在陪诊员管理页面集成预览器 | - | 3h | ❌ |
| 测试身份切换和数据覆盖 | - | 2h | ❌ |

**第四周追加（双会话 + 工作台）：**

> ⚠️ **实施顺序调整**：工作台接口依赖 escortToken，必须先完成 token 体系，再做页面。

**第四周 Part 1：Token 体系与入口（必须先完成）**

| 任务 | 负责人 | 预估工时 | 状态 | 依赖 |
|------|--------|---------|------|------|
| 实现双会话机制（UserSession + EscortSession） | - | 6h | ❌ | 无 |
| 实现请求分流（userRequest / escortRequest） | - | 4h | ❌ | 双会话机制 |
| 实现终端"我的页"陪诊员入口 | - | 4h | ❌ | 双会话机制 |
| 实现二次登录流程 | - | 4h | ❌ | 请求分流 |
| 实现退出陪诊员功能 | - | 2h | ❌ | 二次登录 |

**第四周 Part 2：工作台页面（基于已稳定的 escortRequest）**

| 任务 | 负责人 | 预估工时 | 状态 | 依赖 |
|------|--------|---------|------|------|
| 在 `previewApi` 中添加工作台 API（escortRequest） | - | 3h | ❌ | 请求分流 |
| 创建 `WorkbenchPage.tsx` | - | 6h | ❌ | 工作台 API |
| 创建 `WorkbenchOrdersPoolPage.tsx` | - | 4h | ❌ | 工作台 API |
| 创建 `WorkbenchEarningsPage.tsx` | - | 4h | ❌ | 工作台 API |
| 创建 `WorkbenchWithdrawPage.tsx` | - | 3h | ❌ | 工作台 API |

**交付物：**
- ✅ 陪诊员列表/详情可在预览器中查看
- ✅ 工作台页面可在预览器中查看（需切换角色）
- ✅ 管理后台陪诊员页面集成预览器
- ✅ 陪诊员入口对普通用户隐藏（或不可用）
- ✅ 陪诊员二次登录成功后可切换视角进入工作台
- ✅ 退出陪诊员后恢复普通用户视角，且不影响用户登录态

### 4.3 阶段三：优化和扩展（P2，第 5 周）

**目标：** 完善功能，处理边缘情况

**任务清单：**

| 任务 | 负责人 | 预估工时 | 状态 |
|------|--------|---------|------|
| 优化数据覆盖机制 | - | 4h | ❌ |
| 完善 Mock 数据 | - | 4h | ❌ |
| 处理权限和角色边界情况 | - | 4h | ❌ |
| 性能优化（懒加载、缓存） | - | 4h | ❌ |
| 文档更新 | - | 4h | ❌ |
| 全面测试 | - | 8h | ❌ |

**交付物：**
- ✅ 完整的集成文档
- ✅ 性能优化报告

---

## 五、优先级矩阵

| 模块 | 业务价值 | 技术复杂度 | 用户影响 | 综合优先级 |
|------|---------|-----------|---------|-----------|
| **营销中心 - 会员** | 高 | 中 | 高 | **P0** |
| **营销中心 - 优惠券** | 高 | 中 | 高 | **P0** |
| **营销中心 - 积分** | 中 | 中 | 中 | P1 |
| **营销中心 - 邀请** | 中 | 低 | 中 | P1 |
| **营销中心 - 活动** | 中 | 中 | 中 | P1 |
| **陪诊员 - 列表/详情** | 高 | 低 | 中 | **P1** |
| **陪诊员 - 工作台** | 中 | 高 | 低 | P2 |
| **分销系统** | 低 | 中 | 低 | P2 |

---

## 六、风险评估

### 6.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| API 不兼容 | 高 | 中 | 提前确认后端 API，提供 Mock 降级 |
| 性能问题 | 中 | 低 | 使用 React Query 缓存，懒加载组件 |
| 类型系统复杂 | 中 | 中 | 渐进式扩展类型，保持向后兼容 |

### 6.2 业务风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 数据不一致 | 中 | 中 | 提供数据覆盖机制，支持 Mock 数据 |
| 角色切换复杂 | 低 | 低 | 简化角色切换逻辑，提供默认角色 |

### 6.3 时间风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 开发时间超期 | 中 | 中 | 分阶段实施，优先核心功能 |
| 测试不充分 | 高 | 低 | 每个阶段完成后进行充分测试 |

---

## 七、验收标准

### 7.1 营销中心页面

- ✅ 会员中心页面可在预览器中正确显示
- ✅ 优惠券列表页面可在预览器中正确显示
- ✅ 积分页面可在预览器中正确显示
- ✅ 邀请页面可在预览器中正确显示
- ✅ 活动页面可在预览器中正确显示
- ✅ 数据覆盖机制正常工作
- ✅ 管理后台相关页面集成预览器

### 7.2 陪诊员系统页面

- ✅ 陪诊员列表页面可在预览器中正确显示
- ✅ 陪诊员详情页面可在预览器中正确显示
- ✅ 工作台页面可在预览器中正确显示（需切换角色）
- ✅ 角色切换功能正常
- ✅ 双会话机制正常工作
- ✅ 管理后台相关页面集成预览器

### 7.3 技术质量

- ✅ 类型系统完整，无 TypeScript 错误
- ✅ 组件遵循现有代码规范
- ✅ API 集成完整，支持错误处理
- ✅ 性能满足要求（页面切换流畅）

