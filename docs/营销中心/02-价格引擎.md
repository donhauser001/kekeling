# ä»·æ ¼å¼•æ“è§„åˆ’æ–‡æ¡£

> è¿”å› [è¥é”€ä¸­å¿ƒæ€»è§ˆ](./README.md)  
> çŠ¶æ€ï¼šâœ… å·²è§„åˆ’

---

## ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ

ä»·æ ¼å¼•æ“æ˜¯è¥é”€ä½“ç³»çš„**åŸºç¡€è®¾æ–½å±‚**ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰ä¼˜æƒ è®¡ç®—ï¼Œç¡®ä¿è§„åˆ™ä¸€è‡´ã€‚

### 1.1 ä»·æ ¼è®¡ç®—æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸä»·      â”‚ â† Service.price
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ æ´»åŠ¨ä¼˜æƒ ï¼ˆå¦‚æœ‰ç”Ÿæ•ˆçš„æ´»åŠ¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ´»åŠ¨ä»·    â”‚ â† Campaign è®¡ç®—
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ ä¼šå‘˜æŠ˜æ‰£ï¼ˆå¦‚ç”¨æˆ·æ˜¯ä¼šå‘˜ä¸”æœåŠ¡å“åº”ä¼šå‘˜æ”¿ç­–ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼šå‘˜ä»·    â”‚ â† MembershipLevel.discount
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ ä¼˜æƒ åˆ¸æŠµæ‰£ï¼ˆå¦‚é€‰æ‹©äº†ä¼˜æƒ åˆ¸ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ¸åä»·    â”‚ â† UserCoupon è®¡ç®—
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ ç§¯åˆ†æŠµæ‰£ï¼ˆå¦‚ä½¿ç”¨ç§¯åˆ†ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®ä»˜ä»·    â”‚ â† æœ€ç»ˆæ”¯ä»˜é‡‘é¢ï¼ˆä¸ä½äºæœ€ä½æ”¯ä»˜é¢ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 å åŠ è§„åˆ™

| æ¨¡å¼ | è¯´æ˜ | è®¡ç®—æ–¹å¼ |
|------|------|---------|
| **ä¹˜æ³•å åŠ **ï¼ˆé»˜è®¤ï¼‰ | æ´»åŠ¨ä¸ä¼šå‘˜å¯å åŠ  | `æ´»åŠ¨ä»· Ã— ä¼šå‘˜æŠ˜æ‰£` |
| **å–æœ€ä¼˜ä»·** | æ´»åŠ¨ä¸ä¼šå‘˜äº’æ–¥ | `min(æ´»åŠ¨ä»·, åŸä»·Ã—ä¼šå‘˜æŠ˜æ‰£)` |

---

## äºŒã€æ•°æ®æ¨¡å‹

### 2.1 ä»·æ ¼é…ç½®

```prisma
model PricingConfig {
  id                    String   @id @default(uuid())
  
  // æŠ˜æ‰£å åŠ è§„åˆ™
  discountStackMode     String   @default("multiply") @map("discount_stack_mode")
  // multiply: ä¹˜æ³•å åŠ ï¼ˆæ´»åŠ¨ä»· Ã— ä¼šå‘˜æŠ˜æ‰£ï¼‰
  // min: å–æœ€ä¼˜ä»·ï¼ˆæ´»åŠ¨ä»·ä¸ä¼šå‘˜ä»·å–è¾ƒä½ï¼‰
  
  // ä¼˜æƒ åˆ¸è§„åˆ™
  couponStackWithMember Boolean  @default(true) @map("coupon_stack_with_member")
  // true: ä¼˜æƒ åˆ¸å¯ä¸ä¼šå‘˜æŠ˜æ‰£å åŠ 
  // false: ä¼˜æƒ åˆ¸ä¸ä¼šå‘˜æŠ˜æ‰£äº’æ–¥ï¼Œå–è¾ƒä¼˜
  
  couponStackWithCampaign Boolean @default(true) @map("coupon_stack_with_campaign")
  // true: ä¼˜æƒ åˆ¸å¯ä¸æ´»åŠ¨å åŠ 
  // false: ä¼˜æƒ åˆ¸ä¸æ´»åŠ¨äº’æ–¥
  
  // ç§¯åˆ†è§„åˆ™
  pointsEnabled         Boolean  @default(true) @map("points_enabled")
  pointsRate            Int      @default(100) @map("points_rate")  // 100ç§¯åˆ†=1å…ƒ
  pointsMaxRate         Int      @default(10)  @map("points_max_rate") // æœ€é«˜æŠµæ‰£10%
  
  // æœ€ä½æ”¯ä»˜
  minPayAmount          Decimal  @default(0.01) @db.Decimal(10, 2) @map("min_pay_amount")
  
  // æ˜¾ç¤ºè§„åˆ™
  showOriginalPrice     Boolean  @default(true) @map("show_original_price")
  showMemberPrice       Boolean  @default(true) @map("show_member_price")
  showSavings           Boolean  @default(true) @map("show_savings")
  
  updatedAt             DateTime @updatedAt @map("updated_at")
  
  @@map("pricing_config")
}
```

---

## ä¸‰ã€è®¡ç®—å¼•æ“å®ç°

### 3.1 è¾“å…¥è¾“å‡ºå®šä¹‰

```typescript
// è®¡ç®—è¾“å…¥
interface PriceCalculationInput {
  serviceId: string;
  userId?: string;           // å¯é€‰ï¼Œåˆ¤æ–­ä¼šå‘˜
  couponId?: string;         // å¯é€‰ï¼Œä½¿ç”¨ä¼˜æƒ åˆ¸
  pointsToUse?: number;      // å¯é€‰ï¼Œä½¿ç”¨ç§¯åˆ†
  campaignId?: string;       // å¯é€‰ï¼ŒæŒ‡å®šæ´»åŠ¨ï¼ˆé€šå¸¸è‡ªåŠ¨åŒ¹é…ï¼‰
}

// è®¡ç®—ç»“æœ
interface PriceCalculationResult {
  // å„å±‚ä»·æ ¼
  originalPrice: number;           // åŸä»·
  campaignPrice: number | null;    // æ´»åŠ¨ä»·
  memberPrice: number | null;      // ä¼šå‘˜ä»·
  couponPrice: number | null;      // åˆ¸åä»·
  finalPrice: number;              // å®ä»˜ä»·
  
  // ä¼˜æƒ æ˜ç»†
  campaignDiscount: number;        // æ´»åŠ¨ä¼˜æƒ é‡‘é¢
  campaignName: string | null;
  memberDiscount: number;          // ä¼šå‘˜ä¼˜æƒ é‡‘é¢
  memberLevelName: string | null;
  couponDiscount: number;          // ä¼˜æƒ åˆ¸æŠµæ‰£
  couponName: string | null;
  pointsDiscount: number;          // ç§¯åˆ†æŠµæ‰£
  pointsUsed: number;              // ä½¿ç”¨ç§¯åˆ†æ•°
  
  // æ±‡æ€»
  totalSavings: number;            // æ€»å…±èŠ‚çœ
  
  // ä¼šå‘˜ç›¸å…³
  isMember: boolean;
  membershipExpireAt: Date | null;
  overtimeWaiverRate: number;      // è¶…æ—¶è´¹å‡å…æ¯”ä¾‹
  
  // å±•ç¤ºç”¨
  breakdown: PriceBreakdownItem[];
}

interface PriceBreakdownItem {
  type: 'original' | 'campaign' | 'member' | 'coupon' | 'points' | 'final';
  label: string;
  amount: number;
  strikethrough?: boolean;
}
```

### 3.2 æ ¸å¿ƒè®¡ç®—é€»è¾‘

```typescript
class PriceEngine {
  constructor(
    private serviceRepo: ServiceRepository,
    private membershipRepo: MembershipRepository,
    private couponRepo: CouponRepository,
    private campaignRepo: CampaignRepository,
    private configRepo: PricingConfigRepository,
  ) {}

  async calculate(input: PriceCalculationInput): Promise<PriceCalculationResult> {
    // 1. è·å–åŸºç¡€æ•°æ®
    const service = await this.serviceRepo.findById(input.serviceId);
    const config = await this.configRepo.get();
    
    // 2. è·å–ç”¨æˆ·ä¼šå‘˜çŠ¶æ€
    const membership = input.userId 
      ? await this.membershipRepo.getEffective(input.userId)
      : null;
    
    // 3. è·å–é€‚ç”¨çš„æ´»åŠ¨
    const campaign = input.campaignId
      ? await this.campaignRepo.findById(input.campaignId)
      : await this.campaignRepo.findActiveForService(input.serviceId);
    
    // 4. è·å–ä¼˜æƒ åˆ¸
    const coupon = input.couponId
      ? await this.couponRepo.findUserCoupon(input.couponId)
      : null;
    
    // === å¼€å§‹è®¡ç®— ===
    
    const originalPrice = Number(service.price);
    let currentPrice = originalPrice;
    
    // 5. è®¡ç®—æ´»åŠ¨ä»·
    let campaignPrice: number | null = null;
    let campaignDiscount = 0;
    
    if (campaign && this.isCampaignApplicable(campaign, service)) {
      campaignPrice = this.applyCampaign(originalPrice, campaign);
      campaignDiscount = originalPrice - campaignPrice;
      
      if (config.discountStackMode === 'multiply') {
        currentPrice = campaignPrice;
      }
    }
    
    // 6. è®¡ç®—ä¼šå‘˜ä»·
    let memberPrice: number | null = null;
    let memberDiscount = 0;
    
    if (membership && service.membershipPolicy !== 'fixed') {
      const discount = service.membershipDiscount ?? membership.discount;
      
      if (config.discountStackMode === 'multiply') {
        // ä¹˜æ³•å åŠ ï¼šåœ¨å½“å‰ä»·æ ¼åŸºç¡€ä¸Šæ‰“æŠ˜
        memberPrice = currentPrice * (discount / 100);
        memberDiscount = currentPrice - memberPrice;
        currentPrice = memberPrice;
      } else {
        // å–æœ€ä¼˜ï¼šåŸä»·æ‰“æŠ˜ vs æ´»åŠ¨ä»·
        const memberPriceFromOriginal = originalPrice * (discount / 100);
        if (!campaignPrice || memberPriceFromOriginal < campaignPrice) {
          memberPrice = memberPriceFromOriginal;
          memberDiscount = originalPrice - memberPrice;
          currentPrice = memberPrice;
          // å¦‚æœèµ°ä¼šå‘˜ä»·ï¼Œæ¸…ç©ºæ´»åŠ¨ä¼˜æƒ 
          campaignDiscount = 0;
          campaignPrice = null;
        } else {
          currentPrice = campaignPrice;
        }
      }
    }
    
    // 7. è®¡ç®—ä¼˜æƒ åˆ¸æŠµæ‰£
    let couponDiscount = 0;
    
    if (coupon && this.canUseCoupon(coupon, currentPrice, config, membership)) {
      couponDiscount = this.calculateCouponDiscount(coupon, currentPrice);
      currentPrice = currentPrice - couponDiscount;
    }
    
    // 8. è®¡ç®—ç§¯åˆ†æŠµæ‰£
    let pointsDiscount = 0;
    let pointsUsed = 0;
    
    if (config.pointsEnabled && input.pointsToUse && input.pointsToUse > 0) {
      const maxPointsDiscount = currentPrice * (config.pointsMaxRate / 100);
      const requestedDiscount = input.pointsToUse / config.pointsRate;
      
      pointsDiscount = Math.min(maxPointsDiscount, requestedDiscount, currentPrice - config.minPayAmount);
      pointsUsed = Math.ceil(pointsDiscount * config.pointsRate);
      currentPrice = currentPrice - pointsDiscount;
    }
    
    // 9. ç¡®ä¿æœ€ä½æ”¯ä»˜é‡‘é¢
    const finalPrice = Math.max(currentPrice, Number(config.minPayAmount));
    
    // 10. è®¡ç®—è¶…æ—¶è´¹å‡å…
    const overtimeWaiverRate = this.calculateOvertimeWaiver(service, membership);
    
    // 11. æ„å»ºç»“æœ
    return {
      originalPrice,
      campaignPrice,
      memberPrice,
      couponPrice: couponDiscount > 0 ? currentPrice + pointsDiscount : null,
      finalPrice: Math.round(finalPrice * 100) / 100,
      
      campaignDiscount,
      campaignName: campaign?.name ?? null,
      memberDiscount,
      memberLevelName: membership?.levelName ?? null,
      couponDiscount,
      couponName: coupon?.name ?? null,
      pointsDiscount,
      pointsUsed,
      
      totalSavings: originalPrice - finalPrice,
      
      isMember: !!membership,
      membershipExpireAt: membership?.expireAt ?? null,
      overtimeWaiverRate,
      
      breakdown: this.buildBreakdown(/* ... */),
    };
  }
  
  private calculateCouponDiscount(coupon: UserCoupon, basePrice: number): number {
    if (basePrice < Number(coupon.minAmount)) {
      return 0;
    }
    
    switch (coupon.type) {
      case 'amount':
        // æ»¡å‡åˆ¸ï¼šæŠµæ‰£å›ºå®šé‡‘é¢ï¼Œä¸è¶…è¿‡è®¢å•é‡‘é¢
        return Math.min(Number(coupon.value), basePrice);
        
      case 'percent':
        // æŠ˜æ‰£åˆ¸ï¼šè®¡ç®—æŠ˜æ‰£é‡‘é¢
        const discountAmount = basePrice * (1 - Number(coupon.value) / 100);
        // å¦‚æœæœ‰æœ€å¤§æŠµæ‰£é™åˆ¶
        return coupon.maxDiscount 
          ? Math.min(discountAmount, Number(coupon.maxDiscount))
          : discountAmount;
        
      case 'free':
        // å…å•åˆ¸
        return basePrice;
        
      default:
        return 0;
    }
  }
  
  private calculateOvertimeWaiver(service: Service, membership: UserMembership | null): number {
    if (!membership) return 0;
    
    // ä¼˜å…ˆçº§ï¼šæœåŠ¡è®¾ç½® > ä¼šå‘˜ç­‰çº§è®¾ç½®
    if (service.membershipOvertimeWaiver !== null) {
      return service.membershipOvertimeWaiver;
    }
    
    return membership.overtimeFeeWaiver;
  }
}
```

---

## å››ã€æœåŠ¡è¯¦æƒ…é¡µå±•ç¤º

### 4.1 ä»·æ ¼å±•ç¤ºé€»è¾‘

```typescript
interface ServicePriceDisplay {
  // å±•ç¤ºä»·æ ¼
  displayPrice: number;        // å½“å‰å±•ç¤ºä»·ï¼ˆæ´»åŠ¨ä»·æˆ–åŸä»·ï¼‰
  originalPrice: number | null; // åˆ’çº¿ä»·ï¼ˆå¦‚æœ‰ï¼‰
  
  // ä¼šå‘˜ä»·é¢„è§ˆï¼ˆæœªç™»å½•æˆ–éä¼šå‘˜çœ‹åˆ°ï¼‰
  memberPricePreview: {
    price: number;
    savings: number;
    levelName: string;
  } | null;
  
  // å½“å‰ç”¨æˆ·ä¼šå‘˜ä»·ï¼ˆå·²ç™»å½•ä¼šå‘˜çœ‹åˆ°ï¼‰
  myMemberPrice: {
    price: number;
    savings: number;
  } | null;
  
  // æ´»åŠ¨ä¿¡æ¯
  campaign: {
    name: string;
    endAt: Date;
  } | null;
  
  // ä¼šå‘˜æƒç›Š
  memberBenefits: {
    overtimeWaiver: number;
    priorityBooking: boolean;
  } | null;
}
```

### 4.2 å±•ç¤ºæ•ˆæœ

```
éä¼šå‘˜ç”¨æˆ·çœ‹åˆ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¥498                                    â”‚
â”‚ Â¥598 åŸä»·                               â”‚
â”‚ ğŸ”¥ å¹´ç»ˆç‰¹æƒ                               â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘‘ å¼€é€šä¼šå‘˜æ›´ä¼˜æƒ                      â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ ä¼šå‘˜ä»· Â¥448.2   å†çœ Â¥49.8          â”‚ â”‚
â”‚ â”‚ è¶…æ—¶è´¹å‡å… 50%                       â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ [å¼€é€šä¼šå‘˜ â†’]                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼šå‘˜ç”¨æˆ·çœ‹åˆ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¥448.2  ä¼šå‘˜ä»·                          â”‚
â”‚ Â¥598 åŸä»·  Â¥498 æ´»åŠ¨ä»·                  â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘‘ æ‚¨çš„ä¼šå‘˜æƒç›Š                      â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ âœ… å·²çœ Â¥149.8                      â”‚ â”‚
â”‚ â”‚ âœ… è¶…æ—¶è´¹å‡å… 50%                    â”‚ â”‚
â”‚ â”‚ âœ… ä¼˜å…ˆæ¥å•                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼šå‘˜ä¸“å±æœåŠ¡ï¼ˆéä¼šå‘˜ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ ä¼šå‘˜ä¸“å±æœåŠ¡                         â”‚
â”‚                                         â”‚
â”‚ æ­¤æœåŠ¡ä»…é™ä¼šå‘˜è´­ä¹°                       â”‚
â”‚                                         â”‚
â”‚ [å¼€é€šä¼šå‘˜ï¼Œç«‹å³è§£é” â†’]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€è®¢å•ä»·æ ¼å¿«ç…§

### 5.1 Order æ¨¡å‹æ‰©å±•

```prisma
model Order {
  // ... ç°æœ‰å­—æ®µ ...
  
  // ä»·æ ¼å¿«ç…§ï¼ˆå®Œæ•´è®°å½•ï¼Œä¾¿äºè¿½æº¯ï¼‰
  priceSnapshot     Json  @map("price_snapshot")
  
  // ä¼šå‘˜å¿«ç…§
  membershipSnapshot Json? @map("membership_snapshot")
}
```

### 5.2 å¿«ç…§ç»“æ„

```typescript
interface OrderPriceSnapshot {
  // è®¡ç®—æ—¶é—´
  calculatedAt: string;
  
  // å„å±‚ä»·æ ¼
  originalPrice: number;
  campaignPrice: number | null;
  memberPrice: number | null;
  finalPrice: number;
  
  // æ´»åŠ¨
  campaignId: string | null;
  campaignName: string | null;
  campaignDiscount: number;
  
  // ä¼šå‘˜
  memberDiscount: number;
  memberLevelName: string | null;
  
  // ä¼˜æƒ åˆ¸
  couponId: string | null;
  couponName: string | null;
  couponDiscount: number;
  
  // ç§¯åˆ†
  pointsUsed: number;
  pointsDiscount: number;
  
  // æ±‡æ€»
  totalSavings: number;
  
  // è¶…æ—¶è´¹å‡å…
  overtimeWaiverRate: number;
}

interface OrderMembershipSnapshot {
  levelId: string;
  levelName: string;
  discount: number;
  overtimeFeeWaiver: number;
  expireAt: string;
}
```

---

## å…­ã€API è®¾è®¡

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/pricing/config | è·å–ä»·æ ¼é…ç½®ï¼ˆåå°ï¼‰ |
| PUT | /api/pricing/config | æ›´æ–°ä»·æ ¼é…ç½®ï¼ˆåå°ï¼‰ |
| POST | /api/pricing/calculate | è®¡ç®—æœåŠ¡ä»·æ ¼ |
| GET | /api/services/:id/price | è·å–æœåŠ¡ä»·æ ¼è¯¦æƒ…ï¼ˆå«ä¼šå‘˜ä»·é¢„è§ˆï¼‰ |

### 6.1 è®¡ç®—æ¥å£ç¤ºä¾‹

**è¯·æ±‚**ï¼š
```json
POST /api/pricing/calculate
{
  "serviceId": "xxx",
  "couponId": "yyy",
  "pointsToUse": 500
}
```

**å“åº”**ï¼š
```json
{
  "code": 0,
  "data": {
    "originalPrice": 598,
    "campaignPrice": 498,
    "memberPrice": 448.2,
    "finalPrice": 423.2,
    "campaignDiscount": 100,
    "campaignName": "å¹´ç»ˆç‰¹æƒ ",
    "memberDiscount": 49.8,
    "memberLevelName": "VIPä¼šå‘˜",
    "couponDiscount": 20,
    "couponName": "æ»¡400å‡20",
    "pointsDiscount": 5,
    "pointsUsed": 500,
    "totalSavings": 174.8,
    "overtimeWaiverRate": 50,
    "breakdown": [
      { "type": "original", "label": "åŸä»·", "amount": 598, "strikethrough": true },
      { "type": "campaign", "label": "æ´»åŠ¨ä¼˜æƒ ", "amount": -100 },
      { "type": "member", "label": "ä¼šå‘˜æŠ˜æ‰£", "amount": -49.8 },
      { "type": "coupon", "label": "ä¼˜æƒ åˆ¸", "amount": -20 },
      { "type": "points", "label": "ç§¯åˆ†æŠµæ‰£", "amount": -5 },
      { "type": "final", "label": "å®ä»˜", "amount": 423.2 }
    ]
  }
}
```
