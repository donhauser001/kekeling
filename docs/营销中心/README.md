# 营销中心架构规划

> 文档版本：v1.1  
> 创建日期：2024-12-11  
> 更新日期：2024-12-11  
> 状态：规划中

---

## 一、概述

营销中心是连接用户增长、消费转化、复购提升的核心系统。

### 1.1 架构分层

```
┌─────────────────────────────────────────────────────────────────────┐
│                         营销中心架构                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  业务层（营销玩法）                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │
│  │  会员系统    │  │  优惠券系统  │  │  活动系统    │                │
│  │ · 会员等级   │  │ · 优惠券模板 │  │ · 限时特惠   │                │
│  │ · 会员套餐   │  │ · 发放规则   │  │ · 秒杀抢购   │                │
│  │ · 会员权益   │  │ · 使用规则   │  │ · 满减促销   │                │
│  │ · 消费升级   │  │             │  │             │                │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                │
│         │                │                │                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │
│  │  积分系统    │  │  邀请系统    │  │  成长体系    │                │
│  │ · 积分获取   │  │ · 邀请奖励   │  │  (预留)     │                │
│  │ · 积分消耗   │  │ · 就诊人邀请 │  │             │                │
│  │ · 积分商城   │  │ · 裂变营销   │  │             │                │
│  └──────┬──────┘  └──────┬──────┘  └─────────────┘                │
│         │                │                                         │
│  ───────┴────────────────┴─────────────────────────────────────── │
│                                                                     │
│  引擎层（统一计算）                                                  │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │                     价格计算引擎 (PriceEngine)                │  │
│  │  输入：服务、用户、优惠券、活动                                │  │
│  │  输出：原价→活动价→会员价→优惠券→实付价                        │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 核心设计原则

| 原则 | 说明 |
|------|------|
| **分层清晰** | 业务层配置规则，引擎层统一计算 |
| **统一计算** | 所有价格通过 PriceEngine，确保规则一致 |
| **快照追溯** | 订单记录完整价格快照，便于对账 |
| **可配置** | 规则通过后台配置，无需代码修改 |
| **防作弊** | 优惠券/邀请/积分都有防刷机制 |

---

## 二、模块文档索引

| 模块 | 文档 | 优先级 | 状态 |
|------|------|--------|------|
| 会员系统 | [01-会员系统.md](./01-会员系统.md) | P0 | ✅ 已规划 |
| 价格引擎 | [02-价格引擎.md](./02-价格引擎.md) | P0 | ✅ 已规划 |
| 优惠券系统 | [03-优惠券系统.md](./03-优惠券系统.md) | P1 | ✅ 已规划 |
| 积分系统 | [04-积分系统.md](./04-积分系统.md) | P2 | 📝 框架规划 |
| 邀请系统 | [05-邀请系统.md](./05-邀请系统.md) | P1 | ✅ 已规划 |
| 活动系统 | [06-活动系统.md](./06-活动系统.md) | P1 | 📝 框架规划 |

---

## 三、后台管理导航

```
营销中心
├── 会员管理
│   ├── 会员等级      /marketing/membership/levels
│   ├── 会员套餐      /marketing/membership/plans
│   ├── 会员列表      /marketing/membership/users
│   └── 消费升级规则  /marketing/membership/upgrade-rules
│
├── 优惠券管理
│   ├── 优惠券模板    /marketing/coupons/templates
│   ├── 发放规则      /marketing/coupons/rules
│   └── 使用记录      /marketing/coupons/records
│
├── 活动管理
│   ├── 活动列表      /marketing/campaigns
│   └── 活动数据      /marketing/campaigns/analytics
│
├── 价格配置          /marketing/pricing
│   （全局叠加规则、最低支付金额等）
│
├── 积分管理
│   ├── 积分规则      /marketing/points/rules
│   ├── 积分明细      /marketing/points/records
│   └── 积分商城      /marketing/points/mall
│
└── 邀请奖励
    ├── 邀请规则      /marketing/referrals/rules
    └── 邀请记录      /marketing/referrals/records
```

**与业务中心的变更**：
- ❌ 删除：业务中心 > 价格政策 (`/pricing-policies`)
- ✅ 新增：服务编辑页 > 会员政策卡片

---

## 四、用户终端入口

```
┌─────────────────────────────────────────────────────────────────────┐
│                       用户终端营销入口                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  首页                                                               │
│  ├── 会员推广条（未开通用户）                                        │
│  ├── 会员状态条（已开通用户）                                        │
│  └── 活动弹窗/Banner                                                │
│                                                                     │
│  服务详情页                                                          │
│  ├── 价格展示（原价、活动价、会员价）                                │
│  ├── 会员权益说明（折扣、超时减免）                                  │
│  └── 会员专属服务提示                                                │
│                                                                     │
│  下单页                                                              │
│  ├── 优惠券选择                                                      │
│  ├── 积分抵扣                                                        │
│  └── 价格明细（清晰展示每层优惠）                                    │
│                                                                     │
│  个人中心                                                            │
│  ├── 会员卡片（状态、权益、续费/升级）                               │
│  ├── 我的优惠券                                                      │
│  ├── 我的积分                                                        │
│  └── 邀请好友                                                        │
│                                                                     │
│  就诊人管理                                                          │
│  └── 邀请就诊人注册                                                  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 五、实施计划

### 5.1 阶段规划

| 阶段 | 内容 | 工期 | 依赖 |
|------|------|------|------|
| Phase 1 | 会员系统（等级、套餐、购买） | 4-5天 | 无 |
| Phase 2 | 价格引擎（统一计算） | 3-4天 | Phase 1 |
| Phase 3 | 服务详情页会员展示 | 2天 | Phase 2 |
| Phase 4 | 个人中心会员模块 | 2天 | Phase 1 |
| Phase 5 | 优惠券系统 | 4-5天 | Phase 2 |
| Phase 6 | 积分系统（基础） | 3-4天 | Phase 2 |
| Phase 7 | 活动系统 | 4-5天 | Phase 2 |
| Phase 8 | 邀请系统（含就诊人邀请） | 3-4天 | Phase 5/6 |
| Phase 9 | 联调测试 | 3-4天 | 全部 |

**预计总工期：28-35天**

### 5.2 各阶段产出物

| 阶段 | 后端 | 前端 | 测试 |
|------|------|------|------|
| Phase 1 | 会员模块 API | 会员中心页、购买页 | 购买/续费/升级测试 |
| Phase 2 | PriceEngine 服务 | - | 价格计算测试 |
| Phase 3 | 服务详情 API 扩展 | 会员权益展示组件 | 展示逻辑测试 |
| Phase 5 | 优惠券模块 API | 优惠券列表/选择页 | 发放/使用测试 |

---

## 六、服务编辑页扩展

在服务编辑页右侧边栏，新增「会员政策」卡片（位于「陪诊员配置」下方）：

```
┌─────────────────────────────────────────┐
│ 👑 会员政策                             │
├─────────────────────────────────────────┤
│                                         │
│ 会员响应模式                             │
│ ┌─────────────────────────────────────┐ │
│ │ 响应会员折扣           ▼ │ │
│ └─────────────────────────────────────┘ │
│ · 响应会员折扣（默认）                   │
│ · 会员专属（普通用户不可购买）           │
│ · 固定价格（不响应任何折扣）             │
│                                         │
│ 专属会员折扣（可选）                     │
│ ┌─────────────────────────────────────┐ │
│ │                              % │ │
│ └─────────────────────────────────────┘ │
│ 留空则使用会员等级默认折扣               │
│                                         │
│ 会员超时费减免（可选）                   │
│ ┌─────────────────────────────────────┐ │
│ │                              % │ │
│ └─────────────────────────────────────┘ │
│ 留空则使用流程或等级默认设置             │
│                                         │
└─────────────────────────────────────────┘
```

---

## 七、异常场景处理

### 7.1 退款处理

| 场景 | 处理方式 |
|------|---------|
| 会员套餐退款 | 按剩余天数比例退款，会员立即失效 |
| 优惠券订单退款 | 优惠券退回（未过期）或作废（已过期） |
| 积分抵扣退款 | 积分退回用户账户 |
| 活动订单退款 | 活动参与次数恢复（如有限购） |

### 7.2 防作弊机制

| 模块 | 机制 |
|------|------|
| 优惠券 | 每人限领数、IP限制、设备指纹 |
| 邀请 | 同设备/IP 限制、手机号实名验证 |
| 积分 | 每日获取上限、异常行为监控 |
| 活动 | 库存锁定、下单限流 |

---

## 八、订单价格快照

所有订单必须记录完整价格快照：

```json
{
  "originalPrice": 598,
  "campaignPrice": 498,
  "campaignName": "年终特惠",
  "memberPrice": 448.2,
  "memberDiscount": 90,
  "memberLevelName": "金卡会员",
  "couponDiscount": 20,
  "couponName": "满400减20",
  "couponId": "xxx",
  "pointsDiscount": 10,
  "pointsUsed": 1000,
  "finalPrice": 418.2,
  "totalSavings": 179.8,
  "overtimeWaiverRate": 50,
  "calculatedAt": "2024-12-11T10:00:00Z"
}
```
