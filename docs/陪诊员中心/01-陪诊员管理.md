# é™ªè¯Šå‘˜ç®¡ç†è§„åˆ’æ–‡æ¡£

> è¿”å› [é™ªè¯Šå‘˜ä¸­å¿ƒæ€»è§ˆ](./README.md)  
> çŠ¶æ€ï¼šâœ… å·²è§„åˆ’  
> ç‰ˆæœ¬ï¼šv1.1  
> æ›´æ–°æ—¥æœŸï¼š2024-12-11

---

## ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ

### 1.1 é™ªè¯Šå‘˜æ¨¡å‹è¯´æ˜

é™ªè¯Šå‘˜æ˜¯å¹³å°çš„æ ¸å¿ƒæœåŠ¡æä¾›è€…ï¼Œé‡‡ç”¨ **ç­‰çº§+æ ‡ç­¾** æ¨¡å¼è¿›è¡Œç®¡ç†ï¼š

```
é™ªè¯Šå‘˜ç­‰çº§ï¼ˆèƒ½åŠ›åˆ†å±‚ï¼‰              æ ‡ç­¾ä½“ç³»ï¼ˆç‰¹å¾æè¿°ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èµ„æ·±é™ªè¯Šå‘˜ (senior)  â”‚          â”‚ æœåŠ¡ç‰¹é•¿æ ‡ç­¾         â”‚
â”‚ Â· 5å¹´ä»¥ä¸Šç»éªŒ        â”‚          â”‚ Â· å„¿ç§‘ä¸“é•¿           â”‚
â”‚ Â· é«˜åˆ†æˆæ¯”ä¾‹ 80%     â”‚          â”‚ Â· è‚¿ç˜¤ç§‘ä¸“å®¶         â”‚
â”‚ Â· ä¼˜å…ˆæ´¾å•æƒé‡ +20   â”‚          â”‚ Â· è€å¹´æŠ¤ç†           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸­çº§é™ªè¯Šå‘˜ (intermediate)       â”‚ æœåŠ¡ç‰¹ç‚¹æ ‡ç­¾         â”‚
â”‚ Â· 2-5å¹´ç»éªŒ          â”‚          â”‚ Â· è€å¿ƒç»†è‡´           â”‚
â”‚ Â· æ ‡å‡†åˆ†æˆæ¯”ä¾‹ 70%   â”‚          â”‚ Â· ç»éªŒä¸°å¯Œ           â”‚
â”‚ Â· æ ‡å‡†æ´¾å•æƒé‡       â”‚          â”‚ Â· 24å°æ—¶æœåŠ¡         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆçº§é™ªè¯Šå‘˜ (junior) â”‚          â”‚ èµ„è´¨è¯ä¹¦æ ‡ç­¾         â”‚
â”‚ Â· 1-2å¹´ç»éªŒ          â”‚          â”‚ Â· æŠ¤å£«æ‰§ä¸šè¯         â”‚
â”‚ Â· åŸºç¡€åˆ†æˆæ¯”ä¾‹ 60%   â”‚          â”‚ Â· å¥åº·ç®¡ç†å¸ˆ         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚ Â· æ€¥æ•‘è¯ä¹¦           â”‚
â”‚ å®ä¹ é™ªè¯Šå‘˜ (trainee) â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Â· 1å¹´ä»¥ä¸‹ç»éªŒ        â”‚
â”‚ Â· å®ä¹ åˆ†æˆæ¯”ä¾‹ 50%   â”‚
â”‚ Â· éœ€å¸¦æ•™æ´¾å•         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 é™ªè¯Šå‘˜çŠ¶æ€

| çŠ¶æ€ | ä»£ç  | è¯´æ˜ | å¯æ‰§è¡Œæ“ä½œ |
|------|------|------|-----------|
| å¾…å®¡æ ¸ | `pending` | æ–°åˆ›å»ºï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ | ç¼–è¾‘èµ„æ–™ |
| å·²æ¿€æ´» | `active` | å®¡æ ¸é€šè¿‡ï¼Œå¯æ­£å¸¸æ¥å• | æ¥å•ã€æœåŠ¡ã€æç° |
| å·²åœç”¨ | `inactive` | ä¸»åŠ¨åœç”¨æˆ–é•¿æœŸæœªæ´»è·ƒ | ç”³è¯·é‡æ–°æ¿€æ´» |
| å·²å°ç¦ | `suspended` | è¿è§„è¢«å°ç¦ | ç”³è¯‰ |

### 1.3 å·¥ä½œçŠ¶æ€

| çŠ¶æ€ | ä»£ç  | è¯´æ˜ | è¿›å…¥æ¡ä»¶ |
|------|------|------|---------|
| ä¼‘æ¯ä¸­ | `resting` | ä¸æ¥å•çŠ¶æ€ | ä¸»åŠ¨åˆ‡æ¢/é»˜è®¤çŠ¶æ€ |
| æ¥å•ä¸­ | `working` | å¯æ¥æ”¶æ–°è®¢å• | ä¸»åŠ¨åˆ‡æ¢ |
| æœåŠ¡ä¸­ | `busy` | æ­£åœ¨æ‰§è¡ŒæœåŠ¡ | å¼€å§‹æœåŠ¡æ—¶è‡ªåŠ¨åˆ‡æ¢ |

---

## äºŒã€æ•°æ®æ¨¡å‹

### 2.1 é™ªè¯Šå‘˜ä¸»è¡¨

```prisma
model Escort {
  id             String    @id @default(uuid())
  
  // è´¦å·å…³è”
  userId         String?   @unique @map("user_id")  // å…³è”å°ç¨‹åºè´¦å·
  
  // åŸºæœ¬ä¿¡æ¯
  name           String                              // å§“å
  gender         String                              // male, female
  phone          String    @unique                   // æ‰‹æœºå·ï¼ˆç”¨äºè‡ªåŠ¨ç»‘å®šï¼‰
  idCard         String?   @map("id_card")           // èº«ä»½è¯å·
  avatar         String?                             // å¤´åƒ URL
  
  // ä¸šåŠ¡å±æ€§
  cityCode       String    @default("110100") @map("city_code")  // åŸå¸‚ä»£ç 
  level          String    @default("junior")        // senior, intermediate, junior, trainee
  experience     String?                             // ä»ä¸šå¹´é™æè¿°
  introduction   String?   @db.Text                  // ä¸ªäººç®€ä»‹
  tags           String?                             // JSON: ["è€å¿ƒç»†è‡´", "ç»éªŒä¸°å¯Œ"]
  certificates   String?   @db.Text                  // JSON: [{name, url, expireDate}]
  
  // æœåŠ¡é…ç½®
  serviceRadius  Int       @default(20) @map("service_radius")  // æœåŠ¡åŠå¾„ km
  serviceHours   String?   @map("service_hours")     // JSON: æœåŠ¡æ—¶æ®µé…ç½®
  
  // ç»Ÿè®¡æ•°æ®
  rating         Float     @default(5.0)             // è¯„åˆ† (5åˆ†åˆ¶)
  ratingCount    Int       @default(0) @map("rating_count")      // è¯„ä»·æ•°é‡
  orderCount     Int       @default(0) @map("order_count")       // å®Œæˆè®¢å•æ•°
  
  // çŠ¶æ€ç®¡ç†
  status         String    @default("pending")       // pending, active, inactive, suspended
  workStatus     String    @default("resting") @map("work_status") // resting, working, busy
  
  // å®¡æ ¸ä¿¡æ¯
  reviewedAt     DateTime? @map("reviewed_at")
  reviewedBy     String?   @map("reviewed_by")
  reviewNote     String?   @map("review_note")
  
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  
  // ç´§æ€¥è”ç³»äººï¼ˆæœåŠ¡ä¸­å‡ºæ„å¤–æ—¶è”ç³»ï¼‰
  emergencyContact  String?  @map("emergency_contact")
  emergencyPhone    String?  @map("emergency_phone")
  
  // å¥åº·çŠ¶æ€
  healthCertExpiry  DateTime? @map("health_cert_expiry")  // å¥åº·è¯åˆ°æœŸæ—¥
  lastHealthCheck   DateTime? @map("last_health_check")   // æœ€è¿‘ä½“æ£€æ—¥æœŸ
  
  // åœ°ç†ä½ç½®ï¼ˆç”¨äºæ™ºèƒ½æ´¾å•ï¼‰
  lastLatitude      Float?   @map("last_latitude")
  lastLongitude     Float?   @map("last_longitude")
  lastLocationAt    DateTime? @map("last_location_at")
  
  // æœåŠ¡èƒ½åŠ›é™åˆ¶
  maxDailyOrders    Int      @default(5) @map("max_daily_orders")   // æ¯æ—¥æœ€å¤§æ¥å•æ•°
  currentDailyOrders Int     @default(0) @map("current_daily_orders") // å½“æ—¥å·²æ¥å•æ•°
  
  // æ´»è·ƒåº¦è¿½è¸ª
  lastActiveAt      DateTime? @map("last_active_at")    // æœ€åæ´»è·ƒæ—¶é—´
  inactiveReason    String?  @map("inactive_reason")    // ä¸æ´»è·ƒåŸå› 
  
  // å…³è”
  user           User?     @relation(fields: [userId], references: [id])
  hospitals      EscortHospital[]
  orders         Order[]
  reviews        EscortReview[]
  wallet         EscortWallet?
  
  @@index([phone])
  @@index([cityCode, status, workStatus])
  @@index([level, status])
  @@index([lastActiveAt])
  @@map("escorts")
}
```

### 2.2 é™ªè¯Šå‘˜ç­‰çº§é…ç½®

```prisma
model EscortLevel {
  id               String   @id @default(uuid())
  code             String   @unique                  // senior, intermediate, junior, trainee
  name             String                            // èµ„æ·±/ä¸­çº§/åˆçº§/å®ä¹ 
  
  // åˆ†æˆé…ç½®
  commissionRate   Int      @default(70) @map("commission_rate")  // é»˜è®¤åˆ†æˆæ¯”ä¾‹
  
  // æ´¾å•æƒé‡
  dispatchWeight   Int      @default(10) @map("dispatch_weight")  // æ´¾å•æƒé‡
  
  // å‡†å…¥æ¡ä»¶
  minExperience    Int?     @map("min_experience")   // æœ€ä½ä»ä¸šå¹´é™ï¼ˆæœˆï¼‰
  minOrderCount    Int?     @map("min_order_count")  // æœ€ä½å®Œæˆè®¢å•æ•°
  minRating        Float?   @map("min_rating")       // æœ€ä½è¯„åˆ†
  
  // æ˜¾ç¤ºé…ç½®
  icon             String?                           // ç­‰çº§å›¾æ ‡
  color            String?                           // æ ‡è¯†é¢œè‰²
  badge            String?                           // å¾½ç« å›¾ç‰‡
  description      String?                           // ç­‰çº§æè¿°
  
  sort             Int      @default(0)
  status           String   @default("active")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
  
  @@map("escort_levels")
}
```

### 2.3 é™ªè¯Šå‘˜æ ‡ç­¾

```prisma
model EscortTag {
  id          String   @id @default(uuid())
  name        String   @unique
  category    String   @default("feature")  // feature(ç‰¹ç‚¹), skill(æŠ€èƒ½), cert(èµ„è´¨)
  color       String?
  icon        String?
  sort        Int      @default(0)
  status      String   @default("active")
  createdAt   DateTime @default(now()) @map("created_at")
  
  @@map("escort_tags")
}
```

### 2.4 é™ªè¯Šå‘˜-åŒ»é™¢å…³è”

```prisma
model EscortHospital {
  id           String   @id @default(uuid())
  escortId     String   @map("escort_id")
  hospitalId   String   @map("hospital_id")
  familiarDepts String? @map("familiar_depts")   // JSON: ["å†…ç§‘", "å¤–ç§‘"]
  isPrimary    Boolean  @default(false) @map("is_primary")  // æ˜¯å¦ä¸»æœåŠ¡åŒ»é™¢
  
  createdAt    DateTime @default(now()) @map("created_at")
  
  escort       Escort   @relation(fields: [escortId], references: [id], onDelete: Cascade)
  hospital     Hospital @relation(fields: [hospitalId], references: [id])
  
  @@unique([escortId, hospitalId])
  @@map("escort_hospitals")
}
```

### 2.5 èµ„è´¨è¯ä¹¦ç»“æ„

```typescript
interface Certificate {
  id: string;           // å”¯ä¸€æ ‡è¯†
  name: string;         // è¯ä¹¦åç§°ï¼šæŠ¤å£«æ‰§ä¸šèµ„æ ¼è¯
  type: string;         // ç±»å‹ï¼šnurse_license, health_cert, training_cert
  number?: string;      // è¯ä¹¦ç¼–å·
  imageUrl: string;     // è¯ä¹¦å›¾ç‰‡
  issueDate?: string;   // å‘è¯æ—¥æœŸ
  expireDate?: string;  // è¿‡æœŸæ—¥æœŸ
  verified: boolean;    // æ˜¯å¦å·²éªŒè¯
  verifiedAt?: string;  // éªŒè¯æ—¶é—´
}
```

### 2.6 æœåŠ¡æ—¶æ®µç»“æ„

```typescript
interface ServiceHours {
  enabled: boolean;           // æ˜¯å¦å¯ç”¨æ—¶æ®µé™åˆ¶
  timezone: string;           // æ—¶åŒº: Asia/Shanghai
  weekdays: {
    [key: number]: {          // 0-6: å‘¨æ—¥-å‘¨å…­
      enabled: boolean;
      slots: Array<{
        start: string;        // "08:00"
        end: string;          // "18:00"
      }>;
    };
  };
  holidays: {
    enabled: boolean;         // èŠ‚å‡æ—¥æ˜¯å¦æ¥å•
  };
}
```

---

## ä¸‰ã€ä¸šåŠ¡é€»è¾‘

### 3.1 åˆ›å»ºé™ªè¯Šå‘˜æµç¨‹

```typescript
async function createEscort(data: CreateEscortDto) {
  // 1. æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨
  const existing = await prisma.escort.findUnique({
    where: { phone: data.phone }
  });
  if (existing) {
    throw new ConflictException('è¯¥æ‰‹æœºå·å·²æ³¨å†Œä¸ºé™ªè¯Šå‘˜');
  }
  
  // 2. æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„ç”¨æˆ·è´¦å·
  const user = await prisma.user.findUnique({
    where: { phone: data.phone }
  });
  
  // 3. åˆ›å»ºé™ªè¯Šå‘˜
  const escort = await prisma.escort.create({
    data: {
      ...data,
      userId: user?.id,           // å¦‚æœç”¨æˆ·å­˜åœ¨ï¼Œè‡ªåŠ¨å…³è”
      status: 'pending',          // æ–°å»ºé»˜è®¤å¾…å®¡æ ¸
      workStatus: 'resting',
      tags: data.tags ? JSON.stringify(data.tags) : null,
      certificates: data.certificates ? JSON.stringify(data.certificates) : null,
      // åŒæ—¶åˆ›å»ºåŒ»é™¢å…³è”
      hospitals: data.hospitalIds?.length ? {
        create: data.hospitalIds.map((hospitalId, index) => ({
          hospitalId,
          isPrimary: index === 0,
        }))
      } : undefined,
    },
    include: {
      hospitals: { include: { hospital: true } }
    }
  });
  
  // 4. åˆ›å»ºé’±åŒ…è´¦æˆ·
  await prisma.escortWallet.create({
    data: { escortId: escort.id }
  });
  
  return escort;
}
```

### 3.2 å®¡æ ¸æµç¨‹

```typescript
async function reviewEscort(
  id: string, 
  action: 'approve' | 'reject', 
  reviewerId: string,
  note?: string
) {
  const escort = await prisma.escort.findUnique({ where: { id } });
  
  if (!escort) {
    throw new NotFoundException('é™ªè¯Šå‘˜ä¸å­˜åœ¨');
  }
  
  if (escort.status !== 'pending') {
    throw new BadRequestException('åªèƒ½å®¡æ ¸å¾…å®¡æ ¸çŠ¶æ€çš„é™ªè¯Šå‘˜');
  }
  
  const newStatus = action === 'approve' ? 'active' : 'inactive';
  
  const updated = await prisma.escort.update({
    where: { id },
    data: {
      status: newStatus,
      reviewedAt: new Date(),
      reviewedBy: reviewerId,
      reviewNote: note,
    }
  });
  
  // å‘é€é€šçŸ¥
  if (escort.userId) {
    await sendNotification({
      userId: escort.userId,
      type: 'escort_review_result',
      data: {
        result: action,
        note,
      }
    });
  }
  
  return updated;
}
```

### 3.3 ç­‰çº§å‡é™é€»è¾‘

```typescript
async function checkAndUpgradeLevel(escortId: string) {
  const escort = await prisma.escort.findUnique({
    where: { id: escortId }
  });
  
  const levels = await prisma.escortLevel.findMany({
    where: { status: 'active' },
    orderBy: { sort: 'desc' }  // ä»é«˜åˆ°ä½æ’åº
  });
  
  // è®¡ç®—ä»ä¸šæœˆæ•°
  const monthsOfExperience = differenceInMonths(new Date(), escort.createdAt);
  
  for (const level of levels) {
    // æ£€æŸ¥æ˜¯å¦æ»¡è¶³å‡çº§æ¡ä»¶
    const meetsExperience = !level.minExperience || monthsOfExperience >= level.minExperience;
    const meetsOrders = !level.minOrderCount || escort.orderCount >= level.minOrderCount;
    const meetsRating = !level.minRating || escort.rating >= level.minRating;
    
    if (meetsExperience && meetsOrders && meetsRating) {
      if (escort.level !== level.code) {
        // å‡çº§
        await prisma.escort.update({
          where: { id: escortId },
          data: { level: level.code }
        });
        
        // å‘é€å‡çº§é€šçŸ¥
        await sendLevelUpNotification(escort, level);
      }
      break;
    }
  }
}
```

### 3.4 åˆ é™¤ä¿æŠ¤

```typescript
async function deleteEscort(id: string) {
  // æ£€æŸ¥æ˜¯å¦æœ‰è¿›è¡Œä¸­çš„è®¢å•
  const activeOrders = await prisma.order.count({
    where: {
      escortId: id,
      status: { in: ['assigned', 'arrived', 'in_progress'] }
    }
  });
  
  if (activeOrders > 0) {
    throw new BadRequestException('è¯¥é™ªè¯Šå‘˜æœ‰è¿›è¡Œä¸­çš„è®¢å•ï¼Œæ— æ³•åˆ é™¤');
  }
  
  // æ£€æŸ¥é’±åŒ…ä½™é¢
  const wallet = await prisma.escortWallet.findUnique({
    where: { escortId: id }
  });
  
  if (wallet && wallet.balance > 0) {
    throw new BadRequestException('è¯¥é™ªè¯Šå‘˜é’±åŒ…æœ‰ä½™é¢ï¼Œè¯·å…ˆå¤„ç†');
  }
  
  // è½¯åˆ é™¤ï¼šæ”¹ä¸ºåœç”¨çŠ¶æ€
  return prisma.escort.update({
    where: { id },
    data: { 
      status: 'inactive',
      userId: null,  // è§£ç»‘è´¦å·
    }
  });
}
```

---

## å››ã€API è®¾è®¡

### 4.1 ç®¡ç†ç«¯ API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/admin/escorts` | è·å–é™ªè¯Šå‘˜åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰ |
| GET | `/admin/escorts/:id` | è·å–é™ªè¯Šå‘˜è¯¦æƒ… |
| POST | `/admin/escorts` | åˆ›å»ºé™ªè¯Šå‘˜ |
| PUT | `/admin/escorts/:id` | æ›´æ–°é™ªè¯Šå‘˜ä¿¡æ¯ |
| DELETE | `/admin/escorts/:id` | åˆ é™¤/åœç”¨é™ªè¯Šå‘˜ |
| PUT | `/admin/escorts/:id/status` | æ›´æ–°é™ªè¯Šå‘˜çŠ¶æ€ |
| PUT | `/admin/escorts/:id/review` | å®¡æ ¸é™ªè¯Šå‘˜ |
| POST | `/admin/escorts/:id/hospitals` | å…³è”åŒ»é™¢ |
| DELETE | `/admin/escorts/:id/hospitals/:hospitalId` | è§£é™¤åŒ»é™¢å…³è” |

### 4.2 ç­‰çº§ç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/admin/escort-levels` | è·å–ç­‰çº§åˆ—è¡¨ |
| POST | `/admin/escort-levels` | åˆ›å»ºç­‰çº§ |
| PUT | `/admin/escort-levels/:id` | æ›´æ–°ç­‰çº§ |
| DELETE | `/admin/escort-levels/:id` | åˆ é™¤ç­‰çº§ |

### 4.3 æ ‡ç­¾ç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/admin/escort-tags` | è·å–æ ‡ç­¾åˆ—è¡¨ |
| POST | `/admin/escort-tags` | åˆ›å»ºæ ‡ç­¾ |
| PUT | `/admin/escort-tags/:id` | æ›´æ–°æ ‡ç­¾ |
| DELETE | `/admin/escort-tags/:id` | åˆ é™¤æ ‡ç­¾ |

### 4.4 DTO å®šä¹‰

```typescript
// åˆ›å»ºé™ªè¯Šå‘˜
class CreateEscortDto {
  name: string;
  gender: 'male' | 'female';
  phone: string;
  avatar?: string;
  idCard?: string;
  cityCode?: string;
  level?: 'senior' | 'intermediate' | 'junior' | 'trainee';
  experience?: string;
  introduction?: string;
  tags?: string[];
  certificates?: Certificate[];
  hospitalIds?: string[];
}

// æ›´æ–°é™ªè¯Šå‘˜
class UpdateEscortDto extends PartialType(CreateEscortDto) {
  status?: 'pending' | 'active' | 'inactive' | 'suspended';
}

// å®¡æ ¸é™ªè¯Šå‘˜
class ReviewEscortDto {
  action: 'approve' | 'reject';
  note?: string;
}

// é™ªè¯Šå‘˜åˆ—è¡¨æŸ¥è¯¢
class QueryEscortDto {
  page?: number;
  pageSize?: number;
  keyword?: string;        // å§“å/æ‰‹æœºå·æœç´¢
  status?: string;
  level?: string;
  cityCode?: string;
  hospitalId?: string;
  sortBy?: 'createdAt' | 'orderCount' | 'rating';
  sortOrder?: 'asc' | 'desc';
}
```

---

## äº”ã€åå°ç•Œé¢è®¾è®¡

### 5.1 åˆ—è¡¨é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é™ªè¯Šå‘˜ç®¡ç†                                                   [+ æ–°å¢é™ªè¯Šå‘˜] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ€: [å…¨éƒ¨â–¼]  ç­‰çº§: [å…¨éƒ¨â–¼]  åŸå¸‚: [å…¨éƒ¨â–¼]  æœç´¢: [____________] ğŸ”      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¡ â”‚ å¤´åƒ  â”‚ å§“å     â”‚ æ‰‹æœº        â”‚ ç­‰çº§   â”‚ æœåŠ¡æ•° â”‚ è¯„åˆ†  â”‚ çŠ¶æ€   â”‚ æ“ä½œ â”‚
â”‚â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”‚
â”‚ â–¡ â”‚ [ğŸ‘¤]  â”‚ å¼ æ™“çº¢   â”‚ 138****8001 â”‚ èµ„æ·±   â”‚ 1258   â”‚ â˜…4.9  â”‚ â— æ´»è·ƒ â”‚ â‹¯   â”‚
â”‚ â–¡ â”‚ [ğŸ‘¤]  â”‚ ææ˜å   â”‚ 138****8002 â”‚ èµ„æ·±   â”‚ 876    â”‚ â˜…4.8  â”‚ â— æ´»è·ƒ â”‚ â‹¯   â”‚
â”‚ â–¡ â”‚ [ğŸ‘¤]  â”‚ ç‹èŠ³     â”‚ 138****8003 â”‚ ä¸­çº§   â”‚ 542    â”‚ â˜…4.7  â”‚ â— æ´»è·ƒ â”‚ â‹¯   â”‚
â”‚ â–¡ â”‚ [ğŸ‘¤]  â”‚ æ–°äºº1    â”‚ 138****8004 â”‚ å®ä¹    â”‚ 0      â”‚ -     â”‚ â—‹ å¾…å®¡ â”‚ â‹¯   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…± 45 æ¡è®°å½•                                        [<] 1 2 3 ... 5 [>]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ–°å¢/ç¼–è¾‘è¡¨å•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°å¢é™ªè¯Šå‘˜                                                          [Ã—]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  åŸºæœ¬ä¿¡æ¯                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å§“å: [å¼ æ™“çº¢______]    æ€§åˆ«: â— å¥³ â—‹ ç”·                 â”‚ â”‚
â”‚  â”‚  â”‚ ä¸Šä¼ å¤´åƒ â”‚  æ‰‹æœº: [13800138001__]  èº«ä»½è¯: [110101********1234__] â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“·     â”‚  åŸå¸‚: [åŒ—äº¬å¸‚__â–¼____]  ç­‰çº§: [èµ„æ·±é™ªè¯Šå‘˜__â–¼]           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  ä»ä¸šå¹´é™: [8å¹´_________]                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  ä¸ªäººç®€ä»‹                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä»äº‹åŒ»ç–—é™ªè¯ŠæœåŠ¡8å¹´ï¼Œç†Ÿæ‚‰åŒ—äº¬å„å¤§ä¸‰ç”²åŒ»é™¢å°±è¯Šæµç¨‹ï¼ŒæœåŠ¡è¿‡ä¸Šåƒä½æ‚£è€…ã€‚   â”‚ â”‚
â”‚  â”‚ ___________________________________________________________________ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  æœåŠ¡æ ‡ç­¾                                                                   â”‚
â”‚  [è€å¿ƒç»†è‡´ Ã—] [ç»éªŒä¸°å¯Œ Ã—] [ä¸‰ç”²åŒ»é™¢ä¸“å®¶ Ã—] [+æ·»åŠ ]                        â”‚
â”‚                                                                             â”‚
â”‚  å…³è”åŒ»é™¢                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â­ åŒ—äº¬åå’ŒåŒ»é™¢         ç†Ÿæ‚‰ç§‘å®¤: [å†…ç§‘] [å¤–ç§‘] [å¿ƒå†…ç§‘] [+]          â”‚ â”‚
â”‚  â”‚    åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢     ç†Ÿæ‚‰ç§‘å®¤: [ç¥ç»å†…ç§‘] [+]                       â”‚ â”‚
â”‚  â”‚    [+ æ·»åŠ åŒ»é™¢]                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  èµ„è´¨è¯ä¹¦                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [ğŸ“„] æŠ¤å£«æ‰§ä¸šèµ„æ ¼è¯    æœ‰æ•ˆæœŸ: 2025-12-31    âœ… å·²éªŒè¯        [Ã—]    â”‚ â”‚
â”‚  â”‚ [ğŸ“„] å¥åº·è¯           æœ‰æ•ˆæœŸ: 2024-06-30    â³ å¾…éªŒè¯        [Ã—]    â”‚ â”‚
â”‚  â”‚ [+ ä¸Šä¼ è¯ä¹¦]                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    [å–æ¶ˆ]  [ä¿å­˜]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å®¡æ ¸å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¡æ ¸é™ªè¯Šå‘˜ - å¼ æ™“çº¢                 [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ å¼ æ™“çº¢                        â”‚   â”‚
â”‚  â”‚ æ‰‹æœº: 13800138001               â”‚   â”‚
â”‚  â”‚ ç­‰çº§: èµ„æ·±é™ªè¯Šå‘˜                 â”‚   â”‚
â”‚  â”‚ ä»ä¸š: 8å¹´                       â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ èµ„è´¨è¯ä¹¦:                        â”‚   â”‚
â”‚  â”‚ âœ… æŠ¤å£«æ‰§ä¸šèµ„æ ¼è¯                â”‚   â”‚
â”‚  â”‚ âœ… å¥åº·è¯                        â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ å…³è”åŒ»é™¢: 3 å®¶                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  å®¡æ ¸æ„è§:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ (å¯é€‰) è¾“å…¥å®¡æ ¸æ„è§...           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        [æ‹’ç»]            [é€šè¿‡]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€ç§å­æ•°æ®

```typescript
const escortLevels = [
  { code: 'senior', name: 'èµ„æ·±é™ªè¯Šå‘˜', commissionRate: 80, dispatchWeight: 20, minOrderCount: 500, minRating: 4.5 },
  { code: 'intermediate', name: 'ä¸­çº§é™ªè¯Šå‘˜', commissionRate: 70, dispatchWeight: 15, minOrderCount: 100, minRating: 4.0 },
  { code: 'junior', name: 'åˆçº§é™ªè¯Šå‘˜', commissionRate: 60, dispatchWeight: 10, minOrderCount: 0 },
  { code: 'trainee', name: 'å®ä¹ é™ªè¯Šå‘˜', commissionRate: 50, dispatchWeight: 5, minOrderCount: 0 },
];

const escortTags = [
  { name: 'è€å¿ƒç»†è‡´', category: 'feature' },
  { name: 'ç»éªŒä¸°å¯Œ', category: 'feature' },
  { name: '24å°æ—¶æœåŠ¡', category: 'feature' },
  { name: 'å„¿ç§‘ä¸“é•¿', category: 'skill' },
  { name: 'è‚¿ç˜¤ç§‘ä¸“å®¶', category: 'skill' },
  { name: 'è€å¹´æŠ¤ç†', category: 'skill' },
  { name: 'æŠ¤å£«æ‰§ä¸šè¯', category: 'cert' },
  { name: 'å¥åº·ç®¡ç†å¸ˆ', category: 'cert' },
];

const escorts = [
  {
    name: 'å¼ æ™“çº¢',
    gender: 'female',
    phone: '13800138001',
    level: 'senior',
    experience: '8å¹´',
    introduction: 'ä»äº‹åŒ»ç–—é™ªè¯ŠæœåŠ¡8å¹´ï¼Œç†Ÿæ‚‰åŒ—äº¬å„å¤§ä¸‰ç”²åŒ»é™¢å°±è¯Šæµç¨‹ã€‚',
    tags: ['è€å¿ƒç»†è‡´', 'ç»éªŒä¸°å¯Œ', 'ä¸‰ç”²åŒ»é™¢ä¸“å®¶'],
    rating: 4.92,
    orderCount: 1258,
    status: 'active',
  },
  // ... æ›´å¤šæ•°æ®
];
```

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†

- [ ] å¯åˆ›å»ºé™ªè¯Šå‘˜å¹¶ä¸Šä¼ å¤´åƒã€è¯ä¹¦
- [ ] å¯ç¼–è¾‘é™ªè¯Šå‘˜æ‰€æœ‰å­—æ®µ
- [ ] å¯è¿›è¡Œèµ„è´¨å®¡æ ¸ï¼ˆé€šè¿‡/æ‹’ç»ï¼‰
- [ ] å¯ç®¡ç†é™ªè¯Šå‘˜ä¸åŒ»é™¢çš„å…³è”å…³ç³»
- [ ] åˆ—è¡¨æ”¯æŒæŒ‰çŠ¶æ€/ç­‰çº§/åŸå¸‚ç­›é€‰
- [ ] åˆ—è¡¨æ”¯æŒæŒ‰å§“å/æ‰‹æœºå·æœç´¢
- [ ] æœ‰è¿›è¡Œä¸­è®¢å•çš„é™ªè¯Šå‘˜æ— æ³•åˆ é™¤
- [ ] ç­‰çº§ç®¡ç†å’Œæ ‡ç­¾ç®¡ç†åŠŸèƒ½å®Œæ•´
- [ ] å¥åº·è¯åˆ°æœŸæé†’åŠŸèƒ½æ­£å¸¸
- [ ] æ¯æ—¥æ¥å•ä¸Šé™æ§åˆ¶ç”Ÿæ•ˆ

---

## å…«ã€è¯ä¹¦éªŒè¯æœºåˆ¶

### 8.1 éªŒè¯ç±»å‹

| è¯ä¹¦ç±»å‹ | éªŒè¯æ–¹å¼ | è¯´æ˜ |
|----------|----------|------|
| æŠ¤å£«æ‰§ä¸šèµ„æ ¼è¯ | è‡ªåŠ¨éªŒè¯ | å¯¹æ¥å›½å®¶å«å¥å§”æŠ¤å£«ç”µå­åŒ–æ³¨å†Œç³»ç»Ÿ |
| å¥åº·ç®¡ç†å¸ˆè¯ | äººå·¥å®¡æ ¸ | ä¸Šä¼ è¯ä¹¦ç…§ç‰‡ï¼Œäººå·¥æ ¸å® |
| å¥åº·è¯ | äººå·¥å®¡æ ¸ + æœ‰æ•ˆæœŸç›‘æ§ | æœ‰æ•ˆæœŸå‰30å¤©æé†’ |
| åŸ¹è®­è¯ä¹¦ | äººå·¥å®¡æ ¸ | å¹³å°å†…éƒ¨åŸ¹è®­è¯ä¹¦ |

### 8.2 éªŒè¯é€»è¾‘

```typescript
interface CertificateVerificationResult {
  verified: boolean;
  verifyType: 'auto' | 'manual';
  verifiedAt?: Date;
  errorMessage?: string;
}

async function verifyCertificate(cert: Certificate): Promise<CertificateVerificationResult> {
  // è‡ªåŠ¨éªŒè¯ç±»å‹
  const autoVerifyTypes = ['nurse_license'];
  
  if (autoVerifyTypes.includes(cert.type)) {
    try {
      // å¯¹æ¥å›½å®¶å«å¥å§”æŠ¤å£«ç”µå­åŒ–æ³¨å†Œç³»ç»Ÿ
      const result = await verifyWithNationalHealthDB({
        certificateNumber: cert.number,
        name: cert.holderName,
        idCard: cert.idCard,
      });
      
      return {
        verified: result.valid,
        verifyType: 'auto',
        verifiedAt: new Date(),
        errorMessage: result.valid ? undefined : result.reason,
      };
    } catch (error) {
      // è‡ªåŠ¨éªŒè¯å¤±è´¥ï¼Œè½¬äººå·¥
      return {
        verified: false,
        verifyType: 'manual',
        errorMessage: 'è‡ªåŠ¨éªŒè¯å¤±è´¥ï¼Œå·²è½¬äººå·¥å®¡æ ¸',
      };
    }
  }
  
  // éœ€äººå·¥å®¡æ ¸
  return {
    verified: false,
    verifyType: 'manual',
  };
}

// è¯ä¹¦è¿‡æœŸæé†’
async function checkCertificateExpiry(): Promise<void> {
  const thirtyDaysLater = new Date();
  thirtyDaysLater.setDate(thirtyDaysLater.getDate() + 30);
  
  const escorts = await prisma.escort.findMany({
    where: {
      status: 'active',
      OR: [
        { healthCertExpiry: { lte: thirtyDaysLater } },
      ]
    }
  });
  
  for (const escort of escorts) {
    // è§£æè¯ä¹¦ JSON
    const certificates = JSON.parse(escort.certificates || '[]');
    const expiringCerts = certificates.filter(c => 
      c.expireDate && new Date(c.expireDate) <= thirtyDaysLater
    );
    
    if (expiringCerts.length > 0) {
      await notificationService.send({
        event: 'escort_cert_expiring',
        recipientId: escort.id,
        recipientType: 'escort',
        data: {
          certificates: expiringCerts.map(c => c.name),
          expireDates: expiringCerts.map(c => c.expireDate),
        }
      });
    }
  }
}
```

---

## ä¹ã€å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| v1.0 | 2024-12-11 | åˆå§‹ç‰ˆæœ¬ | - |
| v1.1 | 2024-12-11 | è¡¥å……ç´§æ€¥è”ç³»äººã€å¥åº·çŠ¶æ€ã€ä½ç½®ä¿¡æ¯ã€æ¯æ—¥æ¥å•é™åˆ¶ç­‰å­—æ®µï¼›æ–°å¢è¯ä¹¦éªŒè¯æœºåˆ¶ | - |
