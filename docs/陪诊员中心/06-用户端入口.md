# ç”¨æˆ·ç«¯å…¥å£è§„åˆ’æ–‡æ¡£

> è¿”å› [é™ªè¯Šå‘˜ä¸­å¿ƒæ€»è§ˆ](./README.md)  
> çŠ¶æ€ï¼šâœ… å·²è§„åˆ’  
> ç‰ˆæœ¬ï¼šv1.1  
> æ›´æ–°æ—¥æœŸï¼š2024-12-11

---

## ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ

### 1.1 å…¥å£åˆ†å¸ƒç­–ç•¥

ç”¨æˆ·åœ¨å¤šä¸ªåœºæ™¯ä¸‹éœ€è¦æ¥è§¦é™ªè¯Šå‘˜ä¿¡æ¯ï¼Œè®¾è®¡åŸåˆ™ï¼š

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **é€‚æ—¶å±•ç¤º** | åœ¨ç”¨æˆ·éœ€è¦æ—¶å±•ç¤ºï¼Œä¸è¿‡åº¦æ‰“æ‰° |
| **ä¿¡æ¯å±‚çº§** | åˆ—è¡¨â†’è¯¦æƒ…â†’é€‰æ‹©ï¼Œæ¸è¿›å¼å‘ˆç° |
| **ä¿¡ä»»å»ºç«‹** | å±•ç¤ºèµ„è´¨ã€è¯„ä»·ã€æœåŠ¡æ•°æ® |
| **è½¬åŒ–å¼•å¯¼** | æ¯ä¸ªå…¥å£éƒ½æœ‰æ˜ç¡®çš„è¡ŒåŠ¨å¼•å¯¼ |

### 1.2 å…¥å£å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç«¯é™ªè¯Šå‘˜å…¥å£åˆ†å¸ƒ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  é¦–é¡µ (pages/index)                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  å¿«æ·å…¥å£åŒºï¼ˆé‡‘åˆšåŒºï¼‰                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”                              â”‚   â”‚
â”‚  â”‚  â”‚é™ªè¯Šâ”‚ â”‚ä»£åŠâ”‚ â”‚é™ªæ£€â”‚ â”‚ä½é™¢â”‚ â”‚æ›´å¤šâ”‚                              â”‚   â”‚
â”‚  â”‚  â”‚æœåŠ¡â”‚ â”‚æŒ‚å·â”‚ â”‚é™ªæŠ¤â”‚ â”‚é™ªæŠ¤â”‚ â”‚... â”‚                              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜                              â”‚   â”‚
â”‚  â”‚     â”‚                                                              â”‚   â”‚
â”‚  â”‚     â–¼ å¯æ–°å¢ã€Œé™ªè¯Šå‘˜ã€å›¾æ ‡å…¥å£                                       â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  æ¨èé™ªè¯Šå‘˜åŒº                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ ä¼˜è´¨é™ªè¯Šå‘˜                                        æŸ¥çœ‹å…¨éƒ¨ â–¶ â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ğŸ‘¤å¼ æŠ¤å£« â”‚ â”‚ğŸ‘¤ææŠ¤å£« â”‚ â”‚ğŸ‘¤ç‹å¸ˆå‚… â”‚                         â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â”‚â˜…4.9 568å•â”‚ â”‚â˜…4.8 423å•â”‚ â”‚â˜…4.7 312å•â”‚                         â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â”‚[ç«‹å³é¢„çº¦]â”‚ â”‚[ç«‹å³é¢„çº¦]â”‚ â”‚[ç«‹å³é¢„çº¦]â”‚                         â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  æœåŠ¡è¯¦æƒ…é¡µ (pages/services/detail)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  é™ªè¯Šå‘˜é€‰æ‹©åŒº                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ é€‰æ‹©é™ªè¯Šå‘˜                                                    â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â— ç³»ç»Ÿæ™ºèƒ½åˆ†é…ï¼ˆæ¨èï¼‰                                         â”‚â”‚   â”‚
â”‚  â”‚  â”‚   æ ¹æ®åŒ»é™¢ã€æ—¶é—´è‡ªåŠ¨åŒ¹é…æœ€ä½³é™ªè¯Šå‘˜                              â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ æŒ‡å®šé™ªè¯Šå‘˜                                   [é€‰æ‹© â–¶]       â”‚â”‚   â”‚
â”‚  â”‚  â”‚   è‡ªä¸»é€‰æ‹©å¿ƒä»ªçš„é™ªè¯Šå‘˜                                         â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  åŒ»é™¢è¯¦æƒ…é¡µ (pages/hospital/detail)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  ç†Ÿæ‚‰æœ¬é™¢çš„é™ªè¯Šå‘˜                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ å¼ æŠ¤å£«  â˜…4.9  ç†Ÿæ‚‰ç§‘å®¤ï¼šå¿ƒå†…ç§‘ã€ç¥ç»å†…ç§‘                     â”‚â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ ææŠ¤å£«  â˜…4.8  ç†Ÿæ‚‰ç§‘å®¤ï¼šå†…åˆ†æ³Œç§‘                            â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  è®¢å•è¯¦æƒ…é¡µ (pages/orders/detail)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  é™ªè¯Šå‘˜ä¿¡æ¯                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ å¼ æŠ¤å£«  é«˜çº§é™ªè¯Šå‘˜                                          â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â˜…4.9  568å•å®Œæˆ                                               â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚â”‚   â”‚
â”‚  â”‚  â”‚ [è”ç³»é™ªè¯Šå‘˜]     [æŸ¥çœ‹è¯¦æƒ…]                                    â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  (æœåŠ¡å®Œæˆå)                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚              [è¯„ä»·é™ªè¯Šå‘˜]                                      â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€é¡µé¢è®¾è®¡

### 2.1 é™ªè¯Šå‘˜åˆ—è¡¨é¡µ

**è·¯ç”±**ï¼š`/pages/escort/list`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† é™ªè¯Šå‘˜                         ç­›é€‰ â–¼ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  [å¥½è¯„ä¼˜å…ˆ] [æ¥å•é‡] [å…¨éƒ¨ç­‰çº§â–¼]        â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [ğŸ‘¤]  å¼ æŠ¤å£«           é«˜çº§    â”‚   â”‚
â”‚  â”‚        â˜…4.9 | 568å• | 5å¹´ç»éªŒ   â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  ä¸‰ç”²åŒ»é™¢æŠ¤å£«å‡ºèº«ï¼Œç†Ÿæ‚‰å„å¤§åŒ»é™¢...â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  [ä¸“ä¸šæ²Ÿé€š] [è€å¿ƒç»†è‡´] [å‡†æ—¶å®ˆçº¦] â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  ğŸ¥ åå’ŒåŒ»é™¢ã€åŒ—å¤§åŒ»é™¢           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [ğŸ‘¤]  ææŠ¤å£«           ä¸­çº§    â”‚   â”‚
â”‚  â”‚        â˜…4.8 | 423å• | 3å¹´ç»éªŒ   â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  æŠ¤ç†ä¸“ä¸šæ¯•ä¸šï¼Œç†Ÿæ‚‰å¸¸è§æ£€æŸ¥æµç¨‹...â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  [æœåŠ¡çƒ­æƒ…] [æ²Ÿé€šé¡ºç•…]           â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  ğŸ¥ ç‘é‡‘åŒ»é™¢                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 é™ªè¯Šå‘˜è¯¦æƒ…é¡µ

**è·¯ç”±**ï¼š`/pages/escort/detail?id=xxx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† é™ªè¯Šå‘˜è¯¦æƒ…                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         [ğŸ‘¤ å¤§å¤´åƒ]             â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚    å¼ æŠ¤å£«  é«˜çº§é™ªè¯Šå‘˜            â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ 98.5% â”‚  568  â”‚  5å¹´   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ å¥½è¯„ç‡ â”‚ å®Œæˆå• â”‚ ç»éªŒ   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“‹ ä¸ªäººä»‹ç»                      â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ æ¯•ä¸šäºä¸Šæµ·åŒ»è¯é«˜ç­‰ä¸“ç§‘å­¦æ ¡æŠ¤ç†... â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ [ä¸“ä¸šæ²Ÿé€š] [è€å¿ƒç»†è‡´] [å‡†æ—¶å®ˆçº¦] â”‚   â”‚
â”‚  â”‚ [åŒ»ä¿ç†Ÿæ‚‰]                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“œ èµ„è´¨è¯ä¹¦                      â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ âœ… æŠ¤å£«æ‰§ä¸šèµ„æ ¼è¯                â”‚   â”‚
â”‚  â”‚ âœ… å¥åº·ç®¡ç†å¸ˆè¯                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¥ ç†Ÿæ‚‰åŒ»é™¢                      â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ åå’ŒåŒ»é™¢    å¿ƒå†…ç§‘ã€ç¥ç»å†…ç§‘     â”‚   â”‚
â”‚  â”‚ åŒ—å¤§åŒ»é™¢    ç¥ç»å¤–ç§‘ã€çš®è‚¤ç§‘     â”‚   â”‚
â”‚  â”‚ ç‘é‡‘åŒ»é™¢    å†…åˆ†æ³Œç§‘             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â­ ç”¨æˆ·è¯„ä»·              æŸ¥çœ‹å…¨éƒ¨â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ ç‹** â˜…â˜…â˜…â˜…â˜…                    â”‚   â”‚
â”‚  â”‚ éå¸¸ä¸“ä¸šï¼Œå¸®æˆ‘æŒ‚åˆ°äº†ä¸“å®¶å·...    â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ æ** â˜…â˜…â˜…â˜…â˜…                    â”‚   â”‚
â”‚  â”‚ å¼ æŠ¤å£«å¾ˆæœ‰è€å¿ƒï¼Œå¯¹è€äººç‰¹åˆ«ç…§é¡¾...â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“ å’¨è¯¢]           [ç«‹å³é¢„çº¦]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 è¯„ä»·é¡µé¢

**è·¯ç”±**ï¼š`/pages/orders/review?orderId=xxx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¯„ä»·é™ªè¯Šå‘˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ‘¤ å¼ æŠ¤å£«  é«˜çº§é™ªè¯Šå‘˜           â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚  æœåŠ¡ï¼šå…¨ç¨‹é™ªè¯Š                  â”‚   â”‚
â”‚  â”‚  åŒ»é™¢ï¼šåŒ—äº¬åå’ŒåŒ»é™¢              â”‚   â”‚
â”‚  â”‚  æ—¶é—´ï¼š2024-12-20               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  æœåŠ¡è¯„åˆ†                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â˜† â˜† â˜† â˜† â˜†                     â”‚   â”‚
â”‚  â”‚  ç‚¹å‡»æ˜Ÿæ˜Ÿè¯„åˆ†                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  æœåŠ¡æ ‡ç­¾ï¼ˆå¯å¤šé€‰ï¼‰                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [å‡†æ—¶åˆ°è¾¾] [ä¸“ä¸šç»†è‡´] [æ€åº¦å¥½]  â”‚   â”‚
â”‚  â”‚ [æ²Ÿé€šé¡ºç•…] [ç»éªŒä¸°å¯Œ] [è€å¿ƒ]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  è¯„ä»·å†…å®¹                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è¯·è¾“å…¥æ‚¨çš„è¯„ä»·...                â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          [æäº¤è¯„ä»·]              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ•°æ®æ¨¡å‹

### 3.1 é™ªè¯Šå‘˜è¯„ä»·

```prisma
model EscortReview {
  id          String   @id @default(uuid())
  orderId     String   @unique @map("order_id")
  escortId    String   @map("escort_id")
  userId      String   @map("user_id")
  
  // è¯„åˆ†
  rating      Int                              // 1-5 æ˜Ÿ
  tags        String[]                         // è¯„ä»·æ ‡ç­¾
  content     String?  @db.Text                // è¯„ä»·å†…å®¹
  
  // å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
  images      String[]                         // è¯„ä»·å›¾ç‰‡
  
  // çŠ¶æ€
  status      String   @default("visible")     // visible, hidden
  
  // å›å¤
  reply       String?  @db.Text                // å•†å®¶å›å¤
  repliedAt   DateTime? @map("replied_at")
  
  createdAt   DateTime @default(now()) @map("created_at")
  
  order       Order    @relation(fields: [orderId], references: [id])
  escort      Escort   @relation(fields: [escortId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
  
  @@index([escortId])
  @@index([userId])
  @@map("escort_reviews")
}
```

### 3.2 è¯„ä»·æ ‡ç­¾é…ç½®

```prisma
model ReviewTag {
  id        String   @id @default(uuid())
  name      String   @unique
  type      String   @default("positive")  // positive, negative
  sort      Int      @default(0)
  status    String   @default("active")
  createdAt DateTime @default(now()) @map("created_at")
  
  @@map("review_tags")
}
```

---

## å››ã€ä¸šåŠ¡é€»è¾‘

### 4.1 è·å–æ¨èé™ªè¯Šå‘˜

```typescript
interface RecommendedEscort {
  id: string;
  name: string;
  avatar: string;
  level: string;
  rating: number;
  orderCount: number;
  tags: string[];
}

async function getRecommendedEscorts(params: {
  hospitalId?: string;
  limit?: number;
}): Promise<RecommendedEscort[]> {
  const where: any = {
    status: 'active',
  };
  
  // å¦‚æœæŒ‡å®šåŒ»é™¢ï¼Œä¼˜å…ˆè¿”å›è¯¥åŒ»é™¢çš„é™ªè¯Šå‘˜
  if (params.hospitalId) {
    where.hospitals = {
      some: { hospitalId: params.hospitalId }
    };
  }
  
  const escorts = await prisma.escort.findMany({
    where,
    select: {
      id: true,
      name: true,
      avatar: true,
      level: true,
      rating: true,
      orderCount: true,
      tags: true,
    },
    orderBy: [
      { rating: 'desc' },
      { orderCount: 'desc' },
    ],
    take: params.limit ?? 6,
  });
  
  return escorts.map(e => ({
    ...e,
    tags: e.tags ? JSON.parse(e.tags) : [],
  }));
}
```

### 4.2 è·å–åŒ»é™¢å…³è”é™ªè¯Šå‘˜

```typescript
async function getEscortsByHospital(hospitalId: string): Promise<Escort[]> {
  const escortHospitals = await prisma.escortHospital.findMany({
    where: { hospitalId },
    include: {
      escort: {
        where: { status: 'active' },
        select: {
          id: true,
          name: true,
          avatar: true,
          level: true,
          rating: true,
          orderCount: true,
          tags: true,
        }
      }
    }
  });
  
  return escortHospitals
    .filter(eh => eh.escort)
    .map(eh => ({
      ...eh.escort,
      familiarDepts: eh.familiarDepts ? JSON.parse(eh.familiarDepts) : [],
    }));
}
```

### 4.3 æäº¤è¯„ä»·

```typescript
async function submitReview(
  userId: string,
  orderId: string,
  data: {
    rating: number;
    tags: string[];
    content?: string;
    images?: string[];
  }
): Promise<EscortReview> {
  // 1. è·å–è®¢å•
  const order = await prisma.order.findUnique({
    where: { id: orderId },
    include: { escort: true }
  });
  
  if (!order || order.userId !== userId) {
    throw new NotFoundException('è®¢å•ä¸å­˜åœ¨');
  }
  
  if (order.status !== 'completed') {
    throw new BadRequestException('è®¢å•æœªå®Œæˆï¼Œæ— æ³•è¯„ä»·');
  }
  
  if (!order.escortId) {
    throw new BadRequestException('è¯¥è®¢å•æ— é™ªè¯Šå‘˜');
  }
  
  // 2. æ£€æŸ¥æ˜¯å¦å·²è¯„ä»·
  const existingReview = await prisma.escortReview.findUnique({
    where: { orderId }
  });
  
  if (existingReview) {
    throw new BadRequestException('è¯¥è®¢å•å·²è¯„ä»·');
  }
  
  // 3. åˆ›å»ºè¯„ä»·
  const review = await prisma.$transaction(async (tx) => {
    const newReview = await tx.escortReview.create({
      data: {
        orderId,
        escortId: order.escortId,
        userId,
        rating: data.rating,
        tags: data.tags,
        content: data.content,
        images: data.images || [],
      }
    });
    
    // 4. æ›´æ–°é™ªè¯Šå‘˜è¯„åˆ†
    await updateEscortRating(tx, order.escortId);
    
    return newReview;
  });
  
  return review;
}

async function updateEscortRating(tx: any, escortId: string): Promise<void> {
  const stats = await tx.escortReview.aggregate({
    where: { escortId, status: 'visible' },
    _avg: { rating: true },
    _count: true,
  });
  
  await tx.escort.update({
    where: { id: escortId },
    data: {
      rating: stats._avg.rating || 5.0,
      ratingCount: stats._count,
    }
  });
}
```

---

## äº”ã€API è®¾è®¡

### 5.1 ç”¨æˆ·ç«¯ API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/escorts` | è·å–é™ªè¯Šå‘˜åˆ—è¡¨ |
| GET | `/escorts/recommended` | è·å–æ¨èé™ªè¯Šå‘˜ |
| GET | `/escorts/:id` | è·å–é™ªè¯Šå‘˜è¯¦æƒ… |
| GET | `/escorts/:id/reviews` | è·å–é™ªè¯Šå‘˜è¯„ä»· |
| POST | `/orders/:id/review` | æäº¤è¯„ä»· |
| GET | `/hospitals/:id/escorts` | è·å–åŒ»é™¢å…³è”é™ªè¯Šå‘˜ |

### 5.2 æ¥å£å“åº”ç¤ºä¾‹

```typescript
// GET /escorts/recommended å“åº”
{
  "code": 0,
  "data": [
    {
      "id": "xxx",
      "name": "å¼ æŠ¤å£«",
      "avatar": "https://...",
      "level": "senior",
      "levelName": "é«˜çº§é™ªè¯Šå‘˜",
      "rating": 4.9,
      "orderCount": 568,
      "tags": ["ä¸“ä¸šæ²Ÿé€š", "è€å¿ƒç»†è‡´"]
    }
  ]
}

// GET /escorts/:id å“åº”
{
  "code": 0,
  "data": {
    "id": "xxx",
    "name": "å¼ æŠ¤å£«",
    "avatar": "https://...",
    "level": "senior",
    "levelName": "é«˜çº§é™ªè¯Šå‘˜",
    "gender": "female",
    "experience": "5å¹´",
    "introduction": "æ¯•ä¸šäºä¸Šæµ·åŒ»è¯é«˜ç­‰ä¸“ç§‘å­¦æ ¡...",
    "rating": 4.9,
    "orderCount": 568,
    "tags": ["ä¸“ä¸šæ²Ÿé€š", "è€å¿ƒç»†è‡´", "å‡†æ—¶å®ˆçº¦"],
    "certificates": [
      { "name": "æŠ¤å£«æ‰§ä¸šèµ„æ ¼è¯", "verified": true }
    ],
    "hospitals": [
      {
        "id": "h1",
        "name": "åŒ—äº¬åå’ŒåŒ»é™¢",
        "familiarDepts": ["å¿ƒå†…ç§‘", "ç¥ç»å†…ç§‘"]
      }
    ],
    "recentReviews": [
      {
        "id": "r1",
        "rating": 5,
        "content": "éå¸¸ä¸“ä¸š...",
        "userName": "ç‹**",
        "createdAt": "2024-12-15"
      }
    ]
  }
}
```

---

## å…­ã€é¦–é¡µæ¨èç»„ä»¶å®ç°

```tsx
// components/RecommendedEscorts.tsx

import { View, Text, Image } from '@tarojs/components';
import Taro from '@tarojs/taro';
import { useState, useEffect } from 'react';
import { get } from '@/services/request';
import Icon from '@/components/Icon';

interface Escort {
  id: string;
  name: string;
  avatar: string;
  level: string;
  levelName: string;
  rating: number;
  orderCount: number;
  tags: string[];
}

export default function RecommendedEscorts() {
  const [escorts, setEscorts] = useState<Escort[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadEscorts();
  }, []);

  const loadEscorts = async () => {
    try {
      const data = await get('/escorts/recommended', { limit: 4 });
      setEscorts(data || []);
    } catch (err) {
      console.error('åŠ è½½æ¨èé™ªè¯Šå‘˜å¤±è´¥:', err);
    } finally {
      setLoading(false);
    }
  };

  if (loading || escorts.length === 0) {
    return null;
  }

  return (
    <View className='recommended-escorts'>
      <View className='section-header'>
        <Text className='section-title'>ä¼˜è´¨é™ªè¯Šå‘˜</Text>
        <View 
          className='section-more'
          onClick={() => Taro.navigateTo({ url: '/pages/escort/list' })}
        >
          <Text>æŸ¥çœ‹å…¨éƒ¨</Text>
          <Icon name='chevron-right' size={16} color='#999' />
        </View>
      </View>

      <View className='escort-grid'>
        {escorts.map(escort => (
          <View
            key={escort.id}
            className='escort-card'
            onClick={() => Taro.navigateTo({ url: `/pages/escort/detail?id=${escort.id}` })}
          >
            <View className='escort-avatar'>
              {escort.avatar ? (
                <Image src={escort.avatar} mode='aspectFill' />
              ) : (
                <View className='avatar-placeholder'>
                  <Icon name='user-check' size={24} color='#52c41a' />
                </View>
              )}
            </View>
            <Text className='escort-name'>{escort.name}</Text>
            <View className='escort-stats'>
              <Icon name='star' size={12} color='#faad14' />
              <Text>{escort.rating}</Text>
              <Text className='divider'>|</Text>
              <Text>{escort.orderCount}å•</Text>
            </View>
            <View 
              className='book-btn'
              onClick={(e) => {
                e.stopPropagation();
                Taro.navigateTo({ 
                  url: `/pages/booking/index?escortId=${escort.id}&escortName=${escort.name}` 
                });
              }}
            >
              ç«‹å³é¢„çº¦
            </View>
          </View>
        ))}
      </View>
    </View>
  );
}
```

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†

### åˆ—è¡¨é¡µ
- [ ] é™ªè¯Šå‘˜åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- [ ] æ”¯æŒæŒ‰å¥½è¯„ç‡/æ¥å•é‡æ’åº
- [ ] æ”¯æŒæŒ‰ç­‰çº§ç­›é€‰
- [ ] ç‚¹å‡»è¿›å…¥è¯¦æƒ…é¡µ

### è¯¦æƒ…é¡µ
- [ ] é™ªè¯Šå‘˜ä¿¡æ¯å®Œæ•´å±•ç¤º
- [ ] è¯„ä»·åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- [ ] å¯ç‚¹å‡»é¢„çº¦æŒ‰é’®ä¸‹å•
- [ ] å¯ç‚¹å‡»å’¨è¯¢æŒ‰é’®

### é¦–é¡µæ¨è
- [ ] æ¨èé™ªè¯Šå‘˜æ­£ç¡®å±•ç¤º
- [ ] å¯å¿«é€Ÿé¢„çº¦
- [ ] å¯æŸ¥çœ‹å…¨éƒ¨

### è¯„ä»·åŠŸèƒ½
- [ ] è®¢å•å®Œæˆåå¯è¯„ä»·
- [ ] è¯„åˆ†ã€æ ‡ç­¾ã€å†…å®¹æäº¤æˆåŠŸ
- [ ] è¯„ä»·åé™ªè¯Šå‘˜è¯„åˆ†æ›´æ–°
- [ ] å·²è¯„ä»·è®¢å•ä¸å¯é‡å¤è¯„ä»·
- [ ] ç”¨æˆ·å¯æŒ‡å®šé™ªè¯Šå‘˜ä¸‹å•
- [ ] æŒ‡å®šé™ªè¯Šå‘˜æ—¶çš„å†²çªæ£€æµ‹æ­£ç¡®

---

## å…«ã€ç”¨æˆ·æŒ‡å®šé™ªè¯Šå‘˜ä¸‹å•

### 8.1 æµç¨‹è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·æŒ‡å®šé™ªè¯Šå‘˜ä¸‹å•æµç¨‹                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æµè§ˆé™ªè¯Šå‘˜  â”‚â”€â”€â”€â–ºâ”‚ é€‰æ‹©é™ªè¯Šå‘˜  â”‚â”€â”€â”€â–ºâ”‚ å¡«å†™è®¢å•    â”‚â”€â”€â”€â–ºâ”‚ æ”¯ä»˜æˆåŠŸ   â”‚ â”‚
â”‚  â”‚ åˆ—è¡¨/è¯¦æƒ…   â”‚    â”‚ ç‚¹å‡»é¢„çº¦    â”‚    â”‚ ç¡®è®¤ä¿¡æ¯    â”‚    â”‚            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚        â”‚
â”‚                                                                   â–¼        â”‚
â”‚                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                               â”‚ è®¢å•çŠ¶æ€: assigned       â”‚  â”‚
â”‚                                               â”‚ è‡ªåŠ¨åˆ†é…ç»™æŒ‡å®šé™ªè¯Šå‘˜     â”‚  â”‚
â”‚                                               â”‚ (æ— éœ€æŠ¢å•)               â”‚  â”‚
â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  ä¸æ™®é€šä¸‹å•çš„åŒºåˆ«ï¼š                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ™®é€šä¸‹å•:  pending â†’ paid â†’ (ç­‰å¾…æŠ¢å•/æ´¾å•) â†’ assigned               â”‚   â”‚
â”‚  â”‚ æŒ‡å®šä¸‹å•:  pending â†’ paid â†’ assigned (ç«‹å³åˆ†é…)                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ä¸‹å•æ—¶é€‰æ‹©é™ªè¯Šå‘˜

```typescript
// åˆ›å»ºè®¢å• DTO æ‰©å±•
interface CreateOrderDto {
  serviceId: string;
  hospitalId: string;
  patientId: string;
  appointmentDate: string;
  appointmentTime: string;
  remarks?: string;
  
  // é™ªè¯Šå‘˜é€‰æ‹©
  escortAssignMode: 'auto' | 'specify';  // åˆ†é…æ¨¡å¼
  escortId?: string;                      // æŒ‡å®šé™ªè¯Šå‘˜ ID (mode=specify æ—¶å¿…å¡«)
}

// åˆ›å»ºè®¢å•æ—¶å¤„ç†
async function createOrder(userId: string, dto: CreateOrderDto): Promise<Order> {
  // 1. åŸºç¡€æ ¡éªŒ
  const service = await validateService(dto.serviceId);
  const hospital = await validateHospital(dto.hospitalId);
  const patient = await validatePatient(dto.patientId, userId);
  
  // 2. å¦‚æœæŒ‡å®šé™ªè¯Šå‘˜ï¼Œè¿›è¡Œé¢å¤–æ ¡éªŒ
  let assignedEscortId: string | null = null;
  
  if (dto.escortAssignMode === 'specify' && dto.escortId) {
    const validation = await validateSpecifiedEscort(
      dto.escortId,
      new Date(dto.appointmentDate),
      dto.appointmentTime,
      dto.hospitalId
    );
    
    if (!validation.valid) {
      throw new BadRequestException(validation.reason);
    }
    
    assignedEscortId = dto.escortId;
  }
  
  // 3. åˆ›å»ºè®¢å•
  const order = await prisma.order.create({
    data: {
      orderNo: generateOrderNo(),
      userId,
      serviceId: dto.serviceId,
      hospitalId: dto.hospitalId,
      patientId: dto.patientId,
      appointmentDate: new Date(dto.appointmentDate),
      appointmentTime: dto.appointmentTime,
      remarks: dto.remarks,
      
      // ä»·æ ¼è®¡ç®—
      originalAmount: service.price,
      paidAmount: await calculateFinalPrice(service.price, userId),
      
      // é™ªè¯Šå‘˜åˆ†é…æ–¹å¼
      assignMethod: dto.escortAssignMode === 'specify' ? 'user_select' : null,
      
      status: 'pending',
    }
  });
  
  // 4. å¦‚æœæŒ‡å®šäº†é™ªè¯Šå‘˜ï¼Œè®°å½•åˆ°è®¢å•å…ƒæ•°æ®
  if (assignedEscortId) {
    await prisma.order.update({
      where: { id: order.id },
      data: {
        extra: {
          specifiedEscortId: assignedEscortId,
        }
      }
    });
  }
  
  return order;
}

// æŒ‡å®šé™ªè¯Šå‘˜æ ¡éªŒ
interface EscortValidationResult {
  valid: boolean;
  reason?: string;
}

async function validateSpecifiedEscort(
  escortId: string,
  appointmentDate: Date,
  appointmentTime: string,
  hospitalId: string
): Promise<EscortValidationResult> {
  const escort = await prisma.escort.findUnique({
    where: { id: escortId },
    include: { hospitals: true }
  });
  
  // 1. æ£€æŸ¥é™ªè¯Šå‘˜æ˜¯å¦å­˜åœ¨ä¸”æ¿€æ´»
  if (!escort) {
    return { valid: false, reason: 'é™ªè¯Šå‘˜ä¸å­˜åœ¨' };
  }
  
  if (escort.status !== 'active') {
    return { valid: false, reason: 'è¯¥é™ªè¯Šå‘˜æš‚ä¸å¯é¢„çº¦' };
  }
  
  // 2. æ£€æŸ¥æ˜¯å¦ç†Ÿæ‚‰è¯¥åŒ»é™¢ï¼ˆå¯é€‰ï¼Œé™ä½è¦æ±‚ï¼‰
  const isFamiliar = escort.hospitals.some(h => h.hospitalId === hospitalId);
  if (!isFamiliar) {
    // ä»…è­¦å‘Šï¼Œä¸é˜»æ­¢
    console.warn(`Escort ${escortId} is not familiar with hospital ${hospitalId}`);
  }
  
  // 3. æ£€æŸ¥æ—¶é—´å†²çª
  const { hasConflict, conflictReason } = await checkTimeConflict(
    escortId,
    appointmentDate,
    appointmentTime
  );
  
  if (hasConflict) {
    return { valid: false, reason: conflictReason };
  }
  
  // 4. æ£€æŸ¥æ¯æ—¥æ¥å•ä¸Šé™
  const todayOrderCount = await prisma.order.count({
    where: {
      escortId,
      appointmentDate,
      status: { notIn: ['cancelled', 'refunded'] }
    }
  });
  
  if (todayOrderCount >= escort.maxDailyOrders) {
    return { valid: false, reason: 'è¯¥é™ªè¯Šå‘˜å½“å¤©é¢„çº¦å·²æ»¡' };
  }
  
  return { valid: true };
}
```

### 8.3 æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨åˆ†é…

```typescript
// æ”¯ä»˜æˆåŠŸå›è°ƒå¤„ç†
async function handlePaymentSuccess(orderId: string): Promise<void> {
  const order = await prisma.order.findUnique({
    where: { id: orderId }
  });
  
  if (!order || order.status !== 'pending') {
    return;
  }
  
  const extra = order.extra as Record<string, any> || {};
  const specifiedEscortId = extra.specifiedEscortId;
  
  await prisma.$transaction(async (tx) => {
    if (specifiedEscortId) {
      // ç”¨æˆ·æŒ‡å®šæ¨¡å¼ï¼šç›´æ¥åˆ†é…
      
      // å†æ¬¡æ ¡éªŒï¼ˆé˜²æ­¢æ”¯ä»˜æœŸé—´çŠ¶æ€å˜åŒ–ï¼‰
      const validation = await validateSpecifiedEscort(
        specifiedEscortId,
        order.appointmentDate,
        order.appointmentTime,
        order.hospitalId!
      );
      
      if (validation.valid) {
        // åˆ†é…ç»™æŒ‡å®šé™ªè¯Šå‘˜
        await tx.order.update({
          where: { id: orderId },
          data: {
            status: 'assigned',
            paidAt: new Date(),
            escortId: specifiedEscortId,
            assignMethod: 'user_select',
            assignedAt: new Date(),
          }
        });
        
        // æ›´æ–°é™ªè¯Šå‘˜å½“æ—¥è®¢å•æ•°
        await tx.escort.update({
          where: { id: specifiedEscortId },
          data: {
            currentDailyOrders: { increment: 1 },
            orderCount: { increment: 1 },
          }
        });
        
        // é€šçŸ¥é™ªè¯Šå‘˜
        await notifyEscort(specifiedEscortId, 'order_user_selected', order);
        
      } else {
        // æŒ‡å®šé™ªè¯Šå‘˜ä¸å¯ç”¨ï¼Œé€€å›æ™®é€šæµç¨‹
        await tx.order.update({
          where: { id: orderId },
          data: {
            status: 'paid',
            paidAt: new Date(),
            assignMethod: null,  // æ¸…é™¤æŒ‡å®šæ¨¡å¼
            extra: {
              ...extra,
              specifiedEscortFailed: true,
              specifiedEscortFailReason: validation.reason,
            }
          }
        });
        
        // é€šçŸ¥ç”¨æˆ·
        await notifyUser(order.userId, 'specified_escort_unavailable', {
          orderNo: order.orderNo,
          reason: validation.reason,
          message: 'æ‚¨æŒ‡å®šçš„é™ªè¯Šå‘˜æš‚æ—¶æ— æ³•æœåŠ¡ï¼Œè®¢å•å·²è½¬ä¸ºç³»ç»Ÿè‡ªåŠ¨åˆ†é…',
        });
      }
    } else {
      // æ™®é€šæ¨¡å¼ï¼šè¿›å…¥ç­‰å¾…æŠ¢å•/æ´¾å•çŠ¶æ€
      await tx.order.update({
        where: { id: orderId },
        data: {
          status: 'paid',
          paidAt: new Date(),
        }
      });
    }
  });
}
```

### 8.4 ä¸‹å•é¡µé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† é¢„çº¦æœåŠ¡                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  æœåŠ¡ä¿¡æ¯                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å…¨ç¨‹é™ªè¯Š                         â”‚   â”‚
â”‚  â”‚ åŒ—äº¬åå’ŒåŒ»é™¢ Â· å¿ƒå†…ç§‘            â”‚   â”‚
â”‚  â”‚ 2024-12-20 09:00                â”‚   â”‚
â”‚  â”‚ Â¥299                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  å°±è¯Šäºº                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¼ å…ˆç”Ÿ Â· ç”· Â· 65å²      [æ›´æ¢ â–¶] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  é™ªè¯Šå‘˜é€‰æ‹©                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â— ç³»ç»Ÿæ™ºèƒ½åˆ†é…ï¼ˆæ¨èï¼‰           â”‚   â”‚
â”‚  â”‚   æ ¹æ®åŒ»é™¢ã€æ—¶é—´è‡ªåŠ¨åŒ¹é…æœ€ä½³é™ªè¯Š â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚ â—‹ æŒ‡å®šé™ªè¯Šå‘˜                     â”‚   â”‚
â”‚  â”‚   é€‰æ‹©å¿ƒä»ªçš„é™ªè¯Šå‘˜ä¸ºæ‚¨æœåŠ¡       â”‚   â”‚
â”‚  â”‚                                  â”‚   â”‚
â”‚  â”‚   å·²é€‰æ‹©ï¼šå¼ æŠ¤å£«ï¼ˆé«˜çº§ï¼‰  [æ›´æ¢]  â”‚   â”‚
â”‚  â”‚   â˜…4.9 Â· 568å• Â· ç†Ÿæ‚‰æœ¬é™¢       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  å¤‡æ³¨                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è€äººè¡ŒåŠ¨ä¸ä¾¿ï¼Œéœ€è¦è½®æ¤…...        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  åˆè®¡: Â¥299                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          [æäº¤è®¢å•]              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€è¯„åˆ†ç®—æ³•ä¼˜åŒ–

### 9.1 å¨å°”é€Šå¾—åˆ†ç®—æ³•

```typescript
/**
 * å¨å°”é€ŠåŒºé—´ä¸‹ç•Œç®—æ³•
 * ç›¸æ¯”ç®€å•å¹³å‡ï¼Œå¯¹æ–°é™ªè¯Šå‘˜æ›´å…¬å¹³ï¼Œå¯¹è¯„ä»·æ•°å°‘çš„æ›´ä¿å®ˆ
 */
function calculateWilsonScore(positive: number, total: number, confidence: number = 0.95): number {
  if (total === 0) return 0;
  
  // z å€¼å¯¹åº”ç½®ä¿¡åº¦: 0.95 -> 1.96, 0.99 -> 2.576
  const z = confidence === 0.95 ? 1.96 : 2.576;
  const phat = positive / total;
  
  const score = (
    phat + z * z / (2 * total) - 
    z * Math.sqrt((phat * (1 - phat) + z * z / (4 * total)) / total)
  ) / (1 + z * z / total);
  
  return Math.max(0, Math.min(1, score));
}

/**
 * ä¼˜åŒ–çš„é™ªè¯Šå‘˜è¯„åˆ†è®¡ç®—
 */
async function updateEscortRating(tx: any, escortId: string): Promise<void> {
  const reviews = await tx.escortReview.findMany({
    where: { escortId, status: 'visible' }
  });
  
  if (reviews.length === 0) {
    // æ— è¯„ä»·ï¼Œä½¿ç”¨é»˜è®¤åˆ†
    await tx.escort.update({
      where: { id: escortId },
      data: { rating: 5.0, ratingCount: 0 }
    });
    return;
  }
  
  // è®¡ç®—å„æ˜Ÿçº§æ•°é‡
  const starCounts = [0, 0, 0, 0, 0]; // 1-5æ˜Ÿ
  for (const review of reviews) {
    starCounts[review.rating - 1]++;
  }
  
  // 5æ˜Ÿå’Œ4æ˜Ÿè§†ä¸º"å¥½è¯„"
  const positiveCount = starCounts[4] + starCounts[3];
  
  // ä½¿ç”¨å¨å°”é€Šå¾—åˆ†è®¡ç®—å¥½è¯„ç‡
  const wilsonScore = calculateWilsonScore(positiveCount, reviews.length);
  
  // è½¬æ¢ä¸º5åˆ†åˆ¶è¯„åˆ† (å¨å°”é€Šå¾—åˆ† 0-1 æ˜ å°„åˆ° 3.0-5.0)
  const wilsonRating = 3.0 + wilsonScore * 2.0;
  
  // æ–°é™ªè¯Šå‘˜å¹³æ»‘å¤„ç†ï¼ˆè¯„ä»·æ•°å°‘æ—¶å‘4.8å€¾æ–œï¼‰
  const baseRating = 4.8;
  const smoothingFactor = Math.min(reviews.length / 20, 1); // 20æ¡è¯„ä»·åå®Œå…¨ä½¿ç”¨å®é™…åˆ†æ•°
  
  const finalRating = baseRating * (1 - smoothingFactor) + wilsonRating * smoothingFactor;
  
  await tx.escort.update({
    where: { id: escortId },
    data: {
      rating: Math.round(finalRating * 100) / 100,
      ratingCount: reviews.length,
    }
  });
}
```

---

## åã€å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| v1.0 | 2024-12-11 | åˆå§‹ç‰ˆæœ¬ | - |
| v1.1 | 2024-12-11 | æ–°å¢ç”¨æˆ·æŒ‡å®šé™ªè¯Šå‘˜ä¸‹å•æµç¨‹ã€å¨å°”é€Šè¯„åˆ†ç®—æ³•ä¼˜åŒ– | - |
