# æ•°æ®åŠ è½½ä¸é”™è¯¯å¤„ç†

## æ•°æ®åŠ è½½çŠ¶æ€ (Loading Skeleton)

å¦‚æœæ˜¯ç‚¹å‡»ç¼–è¾‘æ‰è¯·æ±‚è¯¦æƒ…æ¥å£ï¼ˆè€Œä¸æ˜¯ç›´æ¥ä¼  row æ•°æ®ï¼‰ï¼Œéœ€è¦æ˜¾ç¤ºéª¨æ¶å±ã€‚

```tsx
import { Skeleton } from '@/components/ui/skeleton'

// åœ¨å¼¹çª—å†…å®¹åŒºåŸŸ
{isLoading ? (
  <div className='space-y-4 p-4'>
    <Skeleton className='h-4 w-full' />
    <Skeleton className='h-10 w-full' />
    <Skeleton className='h-4 w-3/4' />
    <Skeleton className='h-10 w-full' />
    <Skeleton className='h-4 w-1/2' />
    <Skeleton className='h-10 w-full' />
  </div>
) : (
  <Form {...form}>
    {/* è¡¨å•å†…å®¹ */}
  </Form>
)}
```

---

## é”™è¯¯å¤„ç†å›æ˜¾è§„èŒƒ

é”™è¯¯åˆ†ä¸ºä¸¤ç±»ï¼Œå¤„ç†æ–¹å¼ä¸åŒï¼š

| é”™è¯¯ç±»å‹ | æ˜¾ç¤ºæ–¹å¼ | è¯´æ˜ |
|---------|---------|------|
| **å­—æ®µçº§éªŒè¯é”™è¯¯** | `FormMessage` | Zod éªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤ºåœ¨å¯¹åº”å­—æ®µä¸‹æ–¹ |
| **API çº§é”™è¯¯** | `toast.error()` | æœåŠ¡ç«¯è¿”å›çš„é”™è¯¯ï¼ˆå¦‚"åç§°é‡å¤"ï¼‰ |

### API é”™è¯¯ä½¿ç”¨ Toast æ˜¾ç¤º

```tsx
const createMutation = useMutation({
  mutationFn: (payload: any) => api.create(payload),
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['items'] })
    onOpenChange(false)
    toast.success('åˆ›å»ºæˆåŠŸ')
  },
  onError: (error: Error) => {
    // API é”™è¯¯ç»Ÿä¸€ç”¨ Toast
    toast.error(error.message || 'åˆ›å»ºå¤±è´¥')
  },
})
```

### ç‰¹æ®Šæƒ…å†µï¼šå¸¸é©»é”™è¯¯æç¤º

å¦‚æœéœ€è¦é”™è¯¯ä¿¡æ¯å¸¸é©»ï¼ˆä¾‹å¦‚é‡è¦è­¦å‘Šï¼‰ï¼Œå¯ä»¥åœ¨è¡¨å•é¡¶éƒ¨æ˜¾ç¤º Alertï¼š

```tsx
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'
import { AlertCircle } from 'lucide-react'

{apiError && (
  <Alert variant='destructive' className='mb-4'>
    <AlertCircle className='h-4 w-4' />
    <AlertTitle>æ“ä½œå¤±è´¥</AlertTitle>
    <AlertDescription>{apiError}</AlertDescription>
  </Alert>
)}
```

---

## URL çŠ¶æ€åŒæ­¥ (Deep Linking) - è¿›é˜¶

å¯¹äºå¤æ‚çš„é…ç½®æŠ½å±‰ï¼ˆSheetï¼‰ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦åˆ†äº«é“¾æ¥ç»™åŒäº‹ï¼š"ä½ å¸®æˆ‘çœ‹çœ‹è¿™ä¸ªé…ç½®"ã€‚

**é€‚ç”¨åœºæ™¯**ï¼š
- è¯¦æƒ…é¡µæŠ½å±‰
- å¤æ‚é…ç½®é¡µé¢
- éœ€è¦æ”¯æŒæµè§ˆå™¨å‰è¿›/åé€€

**å®ç°æ–¹å¼**ï¼šä½¿ç”¨ URL Query å‚æ•°åŒæ­¥å¼¹çª—çŠ¶æ€ã€‚

```tsx
import { useSearchParams } from 'react-router-dom'

function PageWithDrawer() {
  const [searchParams, setSearchParams] = useSearchParams()
  
  // ä» URL è¯»å–çŠ¶æ€
  const drawerId = searchParams.get('drawer')
  const itemId = searchParams.get('id')
  
  const handleOpenDetail = (id: string) => {
    setSearchParams({ drawer: 'detail', id })
  }
  
  const handleClose = () => {
    setSearchParams({})
  }
  
  return (
    <>
      {/* åˆ—è¡¨ */}
      <DataTable onRowClick={(row) => handleOpenDetail(row.id)} />
      
      {/* æŠ½å±‰ï¼šæ ¹æ® URL å‚æ•°æ§åˆ¶ */}
      <Sheet 
        open={drawerId === 'detail' && !!itemId} 
        onOpenChange={(open) => !open && handleClose()}
      >
        <DetailContent itemId={itemId} />
      </Sheet>
    </>
  )
}
```

> ğŸ“ **æ³¨æ„**ï¼šæ­¤ä¸ºè¿›é˜¶åŠŸèƒ½ï¼Œä¸€èˆ¬ä¸šåŠ¡å¼¹çª—ä¸éœ€è¦å®ç°ï¼Œä»…åœ¨ç¡®æœ‰åˆ†äº«/ä¹¦ç­¾éœ€æ±‚æ—¶ä½¿ç”¨ã€‚

---

## æˆåŠŸå›è°ƒ

å¼¹çª—ç»„ä»¶åº”æä¾› `onSuccess` å›è°ƒï¼Œä¾¿äºçˆ¶ç»„ä»¶æ‰§è¡Œé¢å¤–æ“ä½œï¼š

```tsx
interface Props {
  open: boolean
  onOpenChange: (open: boolean) => void
  currentRow?: ItemType
  onSuccess?: () => void  // æˆåŠŸåçš„å›è°ƒ
}

// åœ¨ mutation onSuccess ä¸­è°ƒç”¨
onSuccess: () => {
  queryClient.invalidateQueries({ queryKey: ['items'] })
  onOpenChange(false)
  toast.success('åˆ›å»ºæˆåŠŸ')
  onSuccess?.()  // é€šçŸ¥çˆ¶ç»„ä»¶
}
```
