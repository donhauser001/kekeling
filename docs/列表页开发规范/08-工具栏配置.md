# 工具栏配置

## 使用 DataTableToolbar

```tsx
import { DataTableToolbar } from '@/components/data-table'

<DataTableToolbar
  table={table}
  searchPlaceholder='搜索...'
  searchKey='name'  // 指定搜索字段，不指定则全局搜索
  filters={[
    {
      columnId: 'status',
      title: '状态',           // 筛选按钮显示的中文名称
      options: [
        { label: '启用', value: 'active' },   // label: 下拉选项的中文名
        { label: '禁用', value: 'inactive' }, // value: 对应的数据值
      ],
    },
    {
      columnId: 'type',
      title: '类型',
      options: [
        { label: '限时特惠', value: 'flash_sale' },
        { label: '新人专享', value: 'newcomer' },
      ],
    },
  ]}
/>
```

---

## 工具栏功能

| 功能 | 组件 | 说明 |
|------|------|------|
| 搜索框 | `Input` | 支持指定字段或全局搜索 |
| 多选筛选器 | `FacetedFilter` | 按钮显示中文标题，支持多选 |
| 列显隐控制 | `ViewOptions` | 显示列的中文名称（需配置 `meta.title`） |
| 重置按钮 | `Button` | 有筛选条件时自动出现 |

---

## Props 说明

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `table` | `Table<TData>` | - | useReactTable 返回的实例 |
| `searchPlaceholder` | `string` | `'筛选...'` | 搜索框占位符（中文） |
| `searchKey` | `string` | - | 搜索字段，不指定则全局搜索 |
| `filters` | `FilterConfig[]` | `[]` | 筛选器配置数组 |
| `showViewOptions` | `boolean` | `true` | 是否显示「显示列」按钮 |

---

## 双视图页面的工具栏配置

在双视图页面中，需要将「显示列」按钮放在视图切换器左侧，此时需要：

1. 设置 `showViewOptions={false}` 禁用内置的显示列按钮
2. 单独添加 `DataTableViewOptions` 组件

```tsx
import { DataTableToolbar, DataTableViewOptions } from '@/components/data-table'

<div className='flex flex-wrap items-center gap-4'>
  {/* 左侧：搜索 + 筛选器 */}
  <DataTableToolbar
    table={table}
    searchPlaceholder='搜索服务名称...'
    showViewOptions={false}  // 禁用内置的显示列
    filters={[...]}
  />

  {/* 右侧：显示列 + 视图切换器 */}
  <div className='ms-auto flex items-center gap-2'>
    <DataTableViewOptions table={table} />
    <Tabs value={viewMode} onValueChange={setViewMode}>
      <TabsList className='h-9'>
        <TabsTrigger value='grid' className='px-2.5' aria-label='网格视图'>
          <LayoutGrid className='h-4 w-4' />
        </TabsTrigger>
        <TabsTrigger value='list' className='px-2.5' aria-label='列表视图'>
          <List className='h-4 w-4' />
        </TabsTrigger>
      </TabsList>
    </Tabs>
  </div>
</div>
```

### 布局说明

| 位置 | 组件 | 说明 |
|------|------|------|
| 左侧 | `DataTableToolbar` | 搜索框 + 筛选器 + 重置按钮 |
| 右侧 | `DataTableViewOptions` | 显示列控制 |
| 最右 | `Tabs` | 视图切换器 |

---

## 显示列控制（ViewOptions）

「显示列」下拉菜单会列出所有可隐藏的列，列名显示规则：

1. **优先使用 `meta.title`**（推荐）
2. 如果 `header` 是字符串，使用该字符串
3. 最后使用 `column.id`（不推荐，会显示英文字段名）

```tsx
// ❌ 显示列菜单会显示 "type"
{
  accessorKey: 'type',
  header: ({ column }) => <DataTableColumnHeader column={column} title='类型' />,
}

// ✅ 显示列菜单会显示 "类型"
{
  accessorKey: 'type',
  header: ({ column }) => <DataTableColumnHeader column={column} title='类型' />,
  meta: { title: '类型' },  // 必须添加
}
```

> ⚠️ **强制要求**：每个列定义必须添加 `meta: { title: '中文名称' }`，详见 [04-列定义](./04-列定义.md)。

---

## 筛选器配置（Filters）

### FilterConfig 类型

```tsx
interface FilterConfig {
  columnId: string        // 对应列的 accessorKey 或 id
  title: string           // 筛选按钮显示的中文标题（如「状态」「类型」）
  options: {
    label: string         // 下拉选项的中文显示文本（如「启用」「禁用」）
    value: string         // 对应的数据值（如 'active', 'inactive'）
    icon?: ComponentType  // 可选：选项前的图标
  }[]
}
```

### 筛选器命名规范

| 配置项 | 说明 | 示例 |
|--------|------|------|
| `columnId` | 数据字段名（英文） | `'status'`, `'type'` |
| `title` | 按钮显示名（中文） | `'状态'`, `'类型'` |
| `options[].label` | 选项显示名（中文） | `'启用'`, `'限时特惠'` |
| `options[].value` | 选项数据值（英文） | `'active'`, `'flash_sale'` |

### 配置示例

```tsx
// 状态筛选器配置
const statusFilter = {
  columnId: 'status',      // 对应 accessorKey: 'status'
  title: '状态',           // 按钮显示「状态」
  options: [
    { label: '启用', value: 'active' },     // 显示「启用」，筛选 status === 'active'
    { label: '禁用', value: 'inactive' },   // 显示「禁用」，筛选 status === 'inactive'
    { label: '待审核', value: 'pending' },  // 显示「待审核」，筛选 status === 'pending'
  ],
}

// 类型筛选器配置（带图标）
const typeFilter = {
  columnId: 'type',
  title: '类型',
  options: [
    { label: '限时特惠', value: 'flash_sale', icon: Zap },
    { label: '新人专享', value: 'newcomer', icon: Gift },
    { label: '满减活动', value: 'threshold', icon: Tag },
  ],
}
```

---

## 完整示例

### 普通列表页

```tsx
import { DataTableToolbar } from '@/components/data-table'
import { CircleCheck, CircleX, Clock } from 'lucide-react'

const statusOptions = [
  { label: '启用', value: 'active', icon: CircleCheck },
  { label: '禁用', value: 'inactive', icon: CircleX },
  { label: '待审核', value: 'pending', icon: Clock },
]

<div className='flex flex-wrap items-center gap-4'>
  <DataTableToolbar
    table={table}
    searchPlaceholder='搜索活动名称...'
    searchKey='name'
    filters={[
      { columnId: 'status', title: '状态', options: statusOptions },
    ]}
  />
</div>
```

### 双视图页面

```tsx
import { DataTableToolbar, DataTableViewOptions } from '@/components/data-table'

<div className='flex flex-wrap items-center gap-4'>
  <DataTableToolbar
    table={table}
    searchPlaceholder='搜索服务名称...'
    showViewOptions={false}
    filters={[
      { columnId: 'categoryId', title: '分类', options: categoryOptions },
      { columnId: 'status', title: '状态', options: statusOptions },
    ]}
  />
  <div className='ms-auto flex items-center gap-2'>
    <DataTableViewOptions table={table} />
    <Tabs ...>视图切换</Tabs>
  </div>
</div>
```

---

## 检查清单

- [ ] 使用 `DataTableToolbar` 组件，**不要自定义筛选实现**
- [ ] 每个列定义都添加了 `meta: { title: '中文名称' }`
- [ ] 筛选器的 `title` 使用中文（如「状态」而非「Status」）
- [ ] 筛选选项的 `label` 使用中文（如「启用」而非「Active」）
- [ ] 搜索框占位符使用中文（如「搜索活动名称...」）
- [ ] 双视图页面设置 `showViewOptions={false}` 并单独添加 `DataTableViewOptions`
