# 表格组件

## 核心依赖

```tsx
import {
  type ColumnFiltersState,
  type PaginationState,
  type SortingState,
  type VisibilityState,
  flexRender,
  getCoreRowModel,
  getFacetedRowModel,
  getFacetedUniqueValues,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from '@tanstack/react-table'
```

---

## 表格配置（服务端分页）

```tsx
const table = useReactTable({
  data,
  columns,
  pageCount: Math.ceil(total / pageSize),
  state: {
    sorting,
    pagination,
    rowSelection,
    columnFilters,
    columnVisibility,
  },
  manualPagination: true,  // 关键：服务端分页
  enableRowSelection: true,
  onRowSelectionChange: setRowSelection,
  onSortingChange: setSorting,
  onColumnFiltersChange: setColumnFilters,
  onColumnVisibilityChange: setColumnVisibility,
  onPaginationChange: (updater) => {
    const newPagination = typeof updater === 'function' ? updater(pagination) : updater
    if (newPagination.pageIndex !== pagination.pageIndex) {
      onPageChange(newPagination.pageIndex + 1)
    }
    if (newPagination.pageSize !== pagination.pageSize) {
      onPageSizeChange(newPagination.pageSize)
    }
  },
  getCoreRowModel: getCoreRowModel(),
  getFilteredRowModel: getFilteredRowModel(),
  getPaginationRowModel: getPaginationRowModel(),
  getSortedRowModel: getSortedRowModel(),
  getFacetedRowModel: getFacetedRowModel(),
  getFacetedUniqueValues: getFacetedUniqueValues(),
})
```

---

## 表格渲染模板

```tsx
import { Skeleton } from '@/components/ui/skeleton'

<div className='overflow-hidden rounded-md border'>
  <Table>
    <TableHeader>
      {table.getHeaderGroups().map((headerGroup) => (
        <TableRow key={headerGroup.id} className='group/row'>
          {headerGroup.headers.map((header) => (
            <TableHead
              key={header.id}
              colSpan={header.colSpan}
              className={cn(
                'bg-background group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted',
                header.column.columnDef.meta?.className
              )}
            >
              {header.isPlaceholder
                ? null
                : flexRender(
                  header.column.columnDef.header,
                  header.getContext()
                )}
            </TableHead>
          ))}
        </TableRow>
      ))}
    </TableHeader>
    <TableBody>
      {isLoading ? (
        // 使用 Skeleton 骨架屏，防止布局抖动
        Array.from({ length: 10 }).map((_, i) => (
          <TableRow key={i}>
            {columns.map((_, j) => (
              <TableCell key={j}>
                <Skeleton className='h-4 w-full' />
              </TableCell>
            ))}
          </TableRow>
        ))
      ) : table.getRowModel().rows?.length ? (
        table.getRowModel().rows.map((row) => (
          <TableRow
            key={row.id}
            data-state={row.getIsSelected() && 'selected'}
            className='group/row'
          >
            {row.getVisibleCells().map((cell) => (
              <TableCell
                key={cell.id}
                className={cn(
                  'bg-background group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted',
                  cell.column.columnDef.meta?.className
                )}
              >
                {flexRender(cell.column.columnDef.cell, cell.getContext())}
              </TableCell>
            ))}
          </TableRow>
        ))
      ) : (
        <TableRow>
          <TableCell colSpan={columns.length} className='h-24 text-center'>
            暂无数据
          </TableCell>
        </TableRow>
      )}
    </TableBody>
  </Table>
</div>
```

---

## 加载状态规范

> ⚠️ **强制要求**：禁止使用简单的文字"加载中..."，必须使用 Skeleton 骨架屏以防止布局抖动。

```tsx
// ❌ 错误
{isLoading && (
  <TableRow>
    <TableCell colSpan={columns.length}>加载中...</TableCell>
  </TableRow>
)}

// ✅ 正确
{isLoading && (
  Array.from({ length: 10 }).map((_, i) => (
    <TableRow key={i}>
      {columns.map((_, j) => (
        <TableCell key={j}>
          <Skeleton className='h-4 w-full' />
        </TableCell>
      ))}
    </TableRow>
  ))
)}
```

---

## 表格容器样式

```tsx
<div className='overflow-hidden rounded-md border'>
  <Table>...</Table>
</div>
```

- `overflow-hidden`：隐藏溢出
- `rounded-md`：圆角边框
- `border`：边框线
