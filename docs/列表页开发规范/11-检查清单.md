# 检查清单

开发新列表页时，请逐项确认以下要点。

---

## 基础架构

- [ ] 文件结构符合规范（index.tsx + components/{table, columns, dialogs}）
- [ ] 布局使用 `Header` + `Main`，**不使用** Card 包裹表格
- [ ] 弹窗组件已拆分为独立文件，且遵循《弹窗开发规范》

---

## 页面布局

- [ ] `Main` 组件使用 `className='flex flex-1 flex-col gap-4 sm:gap-6'`
- [ ] 标题区使用 `className='flex flex-wrap items-end justify-between gap-2'`
- [ ] 组件间距通过 `Main` 的 `gap` 控制，**不要使用额外的 `mb-*`**
- [ ] 表格使用 `<div className='overflow-hidden rounded-md border'>` 包裹（不是 Card）

---

## 工具栏

- [ ] 使用 `DataTableToolbar` 组件，**不要自定义筛选实现**
- [ ] 搜索框占位符使用中文（如「搜索名称...」）
- [ ] 筛选器的 `title` 使用中文（如「状态」而非「Status」）
- [ ] 筛选选项的 `label` 使用中文（如「启用」而非「Active」）

---

## 表格交互

- [ ] 加载状态使用 **Skeleton 骨架屏**（不是 Loader2 旋转图标）
- [ ] 服务端分页配置正确 (`manualPagination: true`)
- [ ] 暂无数据时显示友好的空状态（图标 + 提示文字）
- [ ] 表格行可点击打开详情抽屉

---

## 翻页组件

- [ ] 使用 `DataTablePagination` 组件
- [ ] **必须**添加 `className='mt-auto'` 固定在底部
- [ ] 仅在有数据时显示翻页组件

---

## 列定义

- [ ] **每列添加 `meta: { title: '中文名' }`**：用于显示列菜单
- [ ] 列头使用 `DataTableColumnHeader` 组件
- [ ] 需要筛选的列添加 `filterFn`
- [ ] **长文本列**添加 `truncate` 和 `max-w` 限制
- [ ] **金额/数字列**设置为右对齐 + 等宽字体 `font-mono`
- [ ] **日期时间列**经过格式化（非 ISO 字符串）
- [ ] **状态列**使用 `Badge variant='outline'` + 颜色映射

---

## 操作菜单

### 结构规范

- [ ] 操作列包含：查看(Sheet)、编辑(Dialog/跳转)、删除(ConfirmDialog)
- [ ] 删除操作前**必须**有 `DropdownMenuSeparator` 分割线

### 属性规范

| 属性/行为 | 规范 | 说明 |
|----------|------|------|
| `DropdownMenu` | `modal={false}` | 避免弹窗层级问题 |
| `DropdownMenuTrigger` | `onClick={(e) => e.stopPropagation()}` | 阻止触发行点击 |
| `DropdownMenuItem` | `onClick={(e) => { e.stopPropagation(); ... }}` | 每个菜单项都要阻止冒泡 |
| `DropdownMenuContent` | `className='w-[160px]'` | 统一菜单宽度 |

### 图标规范

- [ ] **所有菜单项**使用 `DropdownMenuShortcut` 添加右侧图标
- [ ] 图标放在 `DropdownMenuShortcut` 内，不是菜单项左侧

```tsx
// ✅ 正确
<DropdownMenuItem>
  查看详情
  <DropdownMenuShortcut><Eye className='h-4 w-4' /></DropdownMenuShortcut>
</DropdownMenuItem>

// ❌ 错误
<DropdownMenuItem>
  <Eye className='mr-2 h-4 w-4' />
  查看详情
</DropdownMenuItem>
```

### 删除样式

- [ ] 删除操作使用 `className='text-destructive focus:text-destructive focus:bg-destructive/10'`

---

## 双视图页面（如适用）

参考 [12-双视图切换](./12-双视图切换.md) 的完整检查清单。

### 核心要求

- [ ] 使用 `useReactTable` 管理表格状态（即使卡片视图不直接使用表格）
- [ ] 视图状态持久化到 URL 参数
- [ ] 设置 `showViewOptions={false}` 禁用 Toolbar 内置显示列
- [ ] 单独添加 `DataTableViewOptions` 放在视图切换器左侧
- [ ] 两种视图共用同一套操作回调和弹窗组件

---

## 快速对照表

| 检查项 | ✅ 正确做法 | ❌ 错误做法 |
|--------|-----------|-----------|
| Main 布局 | `className='flex flex-1 flex-col gap-4 sm:gap-6'` | 无 className 或使用 mb-* |
| 翻页位置 | `className='mt-auto'` | 无 mt-auto（不固定底部） |
| 表格容器 | `<div className='...rounded-md border'>` | `<Card>` 包裹 |
| 列定义 | `meta: { title: '中文名' }` | 无 meta.title（显示英文） |
| 加载状态 | Skeleton 骨架屏 | Loader2 旋转图标 / "加载中..." |
| 操作菜单 | `modal={false}` + 阻止冒泡 | 无 modal 属性 / 不阻止冒泡 |
| 菜单图标 | `DropdownMenuShortcut` 右侧图标 | 左侧图标 `mr-2` |
| 删除样式 | 分割线 + `text-destructive` 完整样式 | 仅 `text-destructive` |
| 筛选实现 | `DataTableToolbar` | 自定义 Select/Input |
| 筛选标题 | 中文（「状态」） | 英文（「Status」） |

---

## 必须引用的组件

```tsx
// 表格相关
import {
  DataTablePagination,
  DataTableToolbar,
  DataTableColumnHeader,
  DataTableViewOptions,  // 双视图页面需要
} from '@/components/data-table'

// UI 组件
import { Badge } from '@/components/ui/badge'
import { Skeleton } from '@/components/ui/skeleton'
import { ConfirmDialog } from '@/components/confirm-dialog'

// 操作菜单
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
```

---

## 操作菜单完整模板

```tsx
<DropdownMenu modal={false}>
  <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>
    <Button variant='ghost' className='h-8 w-8 p-0 data-[state=open]:bg-muted'>
      <span className='sr-only'>打开菜单</span>
      <MoreHorizontal className='h-4 w-4' />
    </Button>
  </DropdownMenuTrigger>
  <DropdownMenuContent align='end' className='w-[160px]'>
    <DropdownMenuItem onClick={(e) => { e.stopPropagation(); onView(item) }}>
      查看详情
      <DropdownMenuShortcut><Eye className='h-4 w-4' /></DropdownMenuShortcut>
    </DropdownMenuItem>
    <DropdownMenuItem onClick={(e) => { e.stopPropagation(); onEdit(item) }}>
      编辑
      <DropdownMenuShortcut><Pencil className='h-4 w-4' /></DropdownMenuShortcut>
    </DropdownMenuItem>
    <DropdownMenuSeparator />
    <DropdownMenuItem
      onClick={(e) => { e.stopPropagation(); onDelete(item) }}
      className='text-destructive focus:text-destructive focus:bg-destructive/10'
    >
      删除
      <DropdownMenuShortcut><Trash2 className='h-4 w-4' /></DropdownMenuShortcut>
    </DropdownMenuItem>
  </DropdownMenuContent>
</DropdownMenu>
```
