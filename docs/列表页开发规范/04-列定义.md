# 列定义

## 基本结构

```tsx
import { type ColumnDef } from '@tanstack/react-table'
import { DataTableColumnHeader } from '@/components/data-table'

interface ColumnsProps {
  onView: (item: ItemType) => void
  onEdit: (item: ItemType) => void
  onDelete: (item: ItemType) => void
}

export function getColumns({ onView, onEdit, onDelete }: ColumnsProps): ColumnDef<ItemType>[] {
  return [
    // 列定义...
  ]
}
```

---

## meta.title 规范（重要）

> ⚠️ **强制要求**：每个列定义必须在 `meta` 中包含 `title` 属性，使用**中文列名**。

`meta.title` 用于「显示列」下拉菜单显示中文列名，而非数据库字段名（如 `type`）。

```tsx
// ❌ 错误：显示列菜单将显示 "type"
{
  accessorKey: 'type',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='类型' />
  ),
  cell: ({ row }) => <Badge>{row.getValue('type')}</Badge>,
}

// ✅ 正确：显示列菜单将显示 "类型"
{
  accessorKey: 'type',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='类型' />
  ),
  cell: ({ row }) => <Badge>{row.getValue('type')}</Badge>,
  meta: { title: '类型' },  // 必须添加
}
```

**规则**：`meta.title` 的值必须与 `DataTableColumnHeader` 的 `title` 属性保持一致。

---

## 常用列类型

### 文本列（可排序）

```tsx
{
  accessorKey: 'name',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='名称' />
  ),
  cell: ({ row }) => (
    <div className='font-medium'>{row.getValue('name')}</div>
  ),
  meta: { title: '名称' },   // 显示列菜单显示中文
  enableHiding: false,       // 禁止隐藏主要列
}
```

### 长文本列（必须截断）

```tsx
{
  accessorKey: 'description',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='描述' />
  ),
  cell: ({ row }) => (
    <div 
      className='max-w-[300px] truncate' 
      title={row.getValue('description')}
    >
      {row.getValue('description')}
    </div>
  ),
  meta: { title: '描述' },
}
```

> ⚠️ **长文本防护**：所有非固定宽度的文本列（如描述、备注、长名称）必须添加 `truncate` + `max-w-[Npx]` 限制，并添加 `title` 属性以便悬停查看完整内容。

### 金额/数字列（右对齐）

```tsx
{
  accessorKey: 'amount',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='金额' className='text-right' />
  ),
  cell: ({ row }) => (
    <div className='text-right font-mono'>
      ¥{Number(row.getValue('amount')).toLocaleString()}
    </div>
  ),
  meta: { title: '金额', className: 'text-right' },
}
```

> ⚠️ **数字格式化规范**：
> - 金额/数字列必须**右对齐**，且使用等宽字体 (`font-mono`)
> - 日期时间禁止直接显示 ISO 字符串，必须经过格式化

### 日期时间列

```tsx
{
  accessorKey: 'createdAt',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='创建时间' />
  ),
  cell: ({ row }) => {
    const date = new Date(row.getValue('createdAt'))
    return (
      <div className='text-muted-foreground'>
        {date.toLocaleDateString('zh-CN')} {date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}
      </div>
    )
  },
  meta: { title: '创建时间' },
}
```

### Badge 列

```tsx
{
  accessorKey: 'type',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='类型' />
  ),
  cell: ({ row }) => (
    <Badge variant='outline'>
      {typeMap[row.getValue('type') as string]}
    </Badge>
  ),
  meta: { title: '类型' },
  filterFn: (row, id, value) => value.includes(row.getValue(id)),
}
```

### 计算列（无 accessorKey）

```tsx
{
  id: 'fullName',
  header: ({ column }) => (
    <DataTableColumnHeader column={column} title='姓名' />
  ),
  cell: ({ row }) => {
    const { firstName, lastName } = row.original
    return <span>{`${firstName} ${lastName}`}</span>
  },
  meta: { title: '姓名' },
  enableSorting: false,
}
```

---

## 列属性说明

| 属性 | 说明 |
|------|------|
| `accessorKey` | 数据字段名 |
| `id` | 列唯一标识（计算列必须） |
| `header` | 表头渲染 |
| `cell` | 单元格渲染 |
| `enableHiding` | 是否允许隐藏（主要列设为 false） |
| `enableSorting` | 是否允许排序 |
| `filterFn` | 筛选函数 |
| `meta` | 自定义元数据（见下表） |

### meta 属性详解

| 属性 | 类型 | 说明 |
|------|------|------|
| `title` | `string` | **必填**，列的中文显示名称，用于「显示列」下拉菜单 |
| `className` | `string` | 列单元格的额外样式类（如 `text-right`） |

```tsx
// 完整的 meta 示例
meta: {
  title: '金额',           // 必填：显示列菜单显示的名称
  className: 'text-right', // 可选：单元格样式
}
```
