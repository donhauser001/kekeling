# 操作列菜单

所有列表页必须包含"操作"列，且必须包含 **查看**、**编辑**、**删除** 三个基础操作。

## 排序与分组规范

| 顺序 | 操作 | 组件 | 说明 |
|------|------|------|------|
| 1 | 查看 (View) | Sheet | 打开详情抽屉 |
| 2 | 编辑 (Edit) | Dialog / 跳转 | 打开编辑弹窗或跳转编辑页 |
| 3 | 业务操作 | - | 视具体业务而定（上架/下架、复制、审核等） |
| - | 分割线 | Separator | 在危险操作前**必须**添加 |
| 4 | 删除 (Delete) | ConfirmDialog | 红色警示样式 |

---

## 必须遵循的规范

### 1. 属性规范

| 组件/属性 | 规范 | 说明 |
|----------|------|------|
| `DropdownMenu` | `modal={false}` | **必须**，避免弹窗层级问题 |
| `DropdownMenuTrigger` | `onClick={(e) => e.stopPropagation()}` | **必须**，阻止触发行点击 |
| `DropdownMenuItem` | `onClick={(e) => { e.stopPropagation(); ... }}` | **必须**，每个菜单项都要阻止冒泡 |
| `DropdownMenuContent` | `className='w-[160px]'` | **必须**，统一菜单宽度 |

### 2. 图标规范

> ⚠️ **强制要求**：所有菜单项必须在右侧使用 `DropdownMenuShortcut` 包裹图标。

```tsx
// ✅ 正确：图标在右侧，使用 DropdownMenuShortcut
<DropdownMenuItem onClick={(e) => { e.stopPropagation(); onView(item) }}>
  查看详情
  <DropdownMenuShortcut><Eye className='h-4 w-4' /></DropdownMenuShortcut>
</DropdownMenuItem>

// ❌ 错误：图标在左侧
<DropdownMenuItem onClick={() => onView(item)}>
  <Eye className='mr-2 h-4 w-4' />
  查看详情
</DropdownMenuItem>

// ❌ 错误：没有阻止冒泡
<DropdownMenuItem onClick={() => onView(item)}>
  查看详情
  <DropdownMenuShortcut><Eye className='h-4 w-4' /></DropdownMenuShortcut>
</DropdownMenuItem>
```

### 3. 删除操作样式

```tsx
className='text-destructive focus:text-destructive focus:bg-destructive/10'
```

| 样式 | 作用 |
|------|------|
| `text-destructive` | 红色文字 |
| `focus:text-destructive` | 聚焦时保持红色 |
| `focus:bg-destructive/10` | 聚焦时浅红色背景 |

---

## 标准代码实现

```tsx
import { MoreHorizontal, Eye, Pencil, Trash2, Copy } from 'lucide-react'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'

// ... 在 columns 定义中
{
  id: 'actions',
  cell: ({ row }) => {
    const item = row.original

    return (
      <DropdownMenu modal={false}>
        <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>
          <Button variant='ghost' className='h-8 w-8 p-0 data-[state=open]:bg-muted'>
            <span className='sr-only'>打开菜单</span>
            <MoreHorizontal className='h-4 w-4' />
          </Button>
        </DropdownMenuTrigger>
        
        <DropdownMenuContent align='end' className='w-[160px]'>
          {/* 1. 查看 - 对应 Sheet */}
          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); onView(item) }}>
            查看详情
            <DropdownMenuShortcut><Eye className='h-4 w-4' /></DropdownMenuShortcut>
          </DropdownMenuItem>

          {/* 2. 编辑 - 对应 Dialog 或跳转 */}
          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); onEdit(item) }}>
            编辑
            <DropdownMenuShortcut><Pencil className='h-4 w-4' /></DropdownMenuShortcut>
          </DropdownMenuItem>

          {/* 3. 业务操作（示例：复制ID） */}
          <DropdownMenuItem onClick={(e) => { e.stopPropagation(); handleCopy(item) }}>
            复制ID
            <DropdownMenuShortcut><Copy className='h-4 w-4' /></DropdownMenuShortcut>
          </DropdownMenuItem>

          <DropdownMenuSeparator />

          {/* 4. 删除 - 危险操作 */}
          <DropdownMenuItem
            onClick={(e) => { e.stopPropagation(); onDelete(item) }}
            className='text-destructive focus:text-destructive focus:bg-destructive/10'
          >
            删除
            <DropdownMenuShortcut><Trash2 className='h-4 w-4' /></DropdownMenuShortcut>
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    )
  },
}
```

---

## 卡片视图中的操作菜单

卡片视图中的操作菜单与列表视图完全一致，额外要求：

```tsx
<DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>
  <Button
    variant='ghost'
    size='icon'
    className='h-8 w-8 opacity-0 group-hover:opacity-100'  // 悬浮显示
  >
    <MoreHorizontal className='h-4 w-4' />
  </Button>
</DropdownMenuTrigger>
```

- 操作按钮默认隐藏 `opacity-0`
- 卡片悬浮时显示 `group-hover:opacity-100`
- 卡片需要添加 `group` 类名

---

## 列定义接口规范

```tsx
interface ColumnsProps {
  onView: (item: ItemType) => void     // 查看详情 → Sheet
  onEdit: (item: ItemType) => void     // 编辑 → Dialog / 跳转
  onDelete: (item: ItemType) => void   // 删除 → ConfirmDialog
  // 其他业务操作...
}
```

---

## 检查清单

- [ ] `DropdownMenu` 添加 `modal={false}`
- [ ] `DropdownMenuTrigger` 添加 `onClick={(e) => e.stopPropagation()}`
- [ ] **每个** `DropdownMenuItem` 添加 `onClick={(e) => { e.stopPropagation(); ... }}`
- [ ] `DropdownMenuContent` 添加 `className='w-[160px]'`
- [ ] 所有菜单项使用 `DropdownMenuShortcut` 添加右侧图标
- [ ] 图标统一使用 `className='h-4 w-4'`
- [ ] 删除操作前添加 `DropdownMenuSeparator`
- [ ] 删除操作使用完整的红色样式
